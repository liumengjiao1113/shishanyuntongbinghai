{"version":3,"file":"task-list.js","sources":["pages/task-list/task-list.vue","D:/浏览器下载/HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvdGFzay1saXN0L3Rhc2stbGlzdC52dWU"],"sourcesContent":["<template>\n  <view class=\"container\">\n    <!-- 遍历所有任务分类 -->\n    <view v-for=\"category in taskCategories\" :key=\"category.id\" class=\"category-wrapper\">\n      <view class=\"category-card\" @click=\"toggleCategory(category.id)\">\n        <text class=\"category-title\">{{ category.name }}</text>\n        <view class=\"arrow\" :class=\"{ 'is-open': activeCategoryId === category.id }\"></view>\n      </view>\n      \n      <!-- 任务列表 -->\n      <view v-if=\"activeCategoryId === category.id\" class=\"task-list-container\">\n        <view v-if=\"category.loading\" class=\"task-card empty\">\n          加载中...\n        </view>\n        <view v-else-if=\"!category.tasks || !category.tasks.length\" class=\"task-card empty\">\n          暂无任务\n        </view>\n        <view \n          v-else \n          v-for=\"(task, index) in category.tasks\" \n          :key=\"task.id\" \n          class=\"task-card\" \n          @click=\"goToDetail(task)\"\n          @longpress=\"showDeleteConfirm(task, index)\"\n        >\n          <text class=\"task-title\">{{ task.taskName }}</text>\n        </view>\n        \n        <!-- 添加任务输入框 -->\n        <view class=\"add-task-input\" v-if=\"showAddTask\">\n          <input \n            class=\"input-field\" \n            v-model=\"newTaskName\" \n            placeholder=\"输入任务名称\" \n            placeholder-class=\"placeholder\"\n            focus\n            @input=\"handleInput\"\n          />\n          <view class=\"confirm-btn\" v-if=\"newTaskName.trim()\" @click=\"addTask\">\n            <text class=\"confirm-icon\">✓</text>\n          </view>\n        </view>\n        \n        <!-- 添加任务按钮 -->\n        <view class=\"add-task-btn\" @click=\"toggleAddTask\">\n          <text class=\"add-icon\">+</text>\n          <text class=\"add-text\">添加任务</text>\n        </view>\n      </view>\n    </view>\n    \n    <!-- 删除确认弹窗 -->\n    <view class=\"modal\" v-if=\"showDeleteModal\">\n      <view class=\"modal-content\">\n        <view class=\"modal-body\">\n          <text>确定删除任务\"{{ deleteTaskName }}\"吗？</text>\n        </view>\n        <view class=\"modal-footer\">\n          <view class=\"modal-btn cancel\" @click=\"cancelDelete\">取消</view>\n          <view class=\"modal-btn confirm\" @click=\"confirmDelete\">删除</view>\n        </view>\n      </view>\n    </view>\n    \n    <CustomTabBar current=\"index\" />\n  </view>\n</template>\n\n<script>\nimport CustomTabBar from '@/components/tabBar/tabBar.vue'\nimport { request } from '../../components/request'\n\nexport default {\n  components: {\n    CustomTabBar\n  },\n  data() {\n    return {\n      taskCategories: [\n        {\n          id: 2,\n          name: '病害叶片采集',\n          value: 'roast',\n          tasks: [\n            {\n              id: 'blade_0001',\n              taskName: '病害叶片采集-2023夏季',\n              description: '病害叶片采集-2023夏季'\n            }\n          ],\n          loading: false,\n          error: null\n        },\n      ],\n      activeCategoryId: null,\n      showAddTask: false,\n      newTaskName: '',\n      taskCounter: 4,\n      showDeleteModal: false,\n      deleteTaskName: '',\n      deleteTaskIndex: -1\n    }\n  },\n  methods: {\n    async toggleCategory(categoryId) {\n      if (this.activeCategoryId === categoryId) {\n        this.activeCategoryId = null\n        this.showAddTask = false\n        return\n      }\n\n      this.activeCategoryId = categoryId\n      this.showAddTask = false\n\n      const category = this.taskCategories.find(c => c.id === categoryId)\n      if (!category) return\n\n      if (category.tasks.length > 0 || category.loading) return\n      await this.fetchTasks(category)\n    },\n\n    async fetchTasks(category) {\n      category.loading = true\n      category.error = null\n\n      try {\n        const res = await request({\n          url: '/task/getTask',\n          method: 'GET',\n          header: {\n            'Authorization': uni.getStorageSync('token')||'',\n            'Content-Type': 'application/json'\n          },\n          data: {\n            typeId: category.id\n          }\n        })\n\n        category.tasks = res.data\n      } catch (error) {\n        console.error('获取任务失败:', error)\n        category.error = error.message || '获取任务失败，请稍后重试'\n      } finally {\n        category.loading = false\n      }\n    },\n\n    goToDetail(task) {\n      console.log('即将传递的任务数据:', {\n        id: task.id,\n        taskName: task.taskName\n      });\n      uni.navigateTo({\n        url: `/pages/task-detail/task-detail?id=${task.id}&taskName=${encodeURIComponent(task.taskName)}`\n      })\n    },\n    \n    toggleAddTask() {\n      this.showAddTask = !this.showAddTask\n      this.newTaskName = ''\n    },\n    \n    handleInput() {\n      // 输入时触发，用于响应式显示✓\n    },\n    \n    addTask() {\n      if (this.newTaskName.trim()) {\n        this.taskCounter++\n        const newId = `blade_${this.taskCounter.toString().padStart(4, '0')}`\n        \n        const category = this.taskCategories.find(c => c.id === this.activeCategoryId)\n        if (category) {\n          category.tasks.push({\n            id: newId,\n            taskName: this.newTaskName,\n            description: this.newTaskName\n          })\n        }\n        \n        this.newTaskName = ''\n        this.showAddTask = false\n      }\n    },\n    \n    showDeleteConfirm(task, index) {\n      this.deleteTaskName = task.taskName\n      this.deleteTaskIndex = index\n      this.showDeleteModal = true\n    },\n    \n    cancelDelete() {\n      this.showDeleteModal = false\n      this.deleteTaskName = ''\n      this.deleteTaskIndex = -1\n    },\n    \n    confirmDelete() {\n      if (this.deleteTaskIndex >= 0) {\n        const category = this.taskCategories.find(c => c.id === this.activeCategoryId)\n        if (category) {\n          category.tasks.splice(this.deleteTaskIndex, 1)\n        }\n      }\n      this.showDeleteModal = false\n      this.deleteTaskName = ''\n      this.deleteTaskIndex = -1\n    }\n  }\n}\n</script>\n\n<style scoped>\n/* 样式保持不变 */\n.container {\n  padding: 50rpx 30rpx 120rpx;\n}\n\n.category-wrapper {\n  margin-bottom: 30rpx;\n}\n\n.category-card {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  background-color: ghostwhite;\n  border-radius: 16rpx;\n  padding: 40rpx 30rpx;\n  box-shadow: 0 4rpx 10rpx rgba(0, 0, 0, 0.05);\n  position: relative;\n  z-index: 10;\n}\n\n.category-title {\n  font-size: 48rpx;\n  font-weight: bold;\n}\n\n.arrow {\n  border: solid #555;\n  border-width: 0 4rpx 4rpx 0;\n  display: inline-block;\n  padding: 8rpx;\n  transform: rotate(45deg);\n  transition: transform 0.3s ease;\n}\n\n.arrow.is-open {\n  transform: rotate(-135deg);\n}\n\n.task-list-container {\n  margin-top: -15rpx;\n  padding-top: 25rpx; \n  background-color: #ffffff;\n  border-radius: 0 0 16rpx 16rpx;\n  box-shadow: 0 8rpx 12rpx rgba(0, 0, 0, 0.04);\n  animation: slideDown 0.3s ease-out; \n}\n\n.task-card {\n  background: #fff;\n  padding: 30rpx;\n  margin: 0 20rpx 20rpx; \n  border-radius: 12rpx;\n  border: 1rpx solid #f0f0f0;\n  text-align: center;\n}\n\n.task-title {\n  font-size: 30rpx;\n  font-weight: 500;\n  color: #333;\n}\n\n.task-card.empty {\n  color: #999;\n  border: 1rpx dashed #ddd;\n}\n\n.add-task-btn {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  height: 80rpx;\n  width: 80rpx;\n  margin: 20rpx auto;\n  background-color: #f8f8f8;\n  border-radius: 40rpx;\n  color: #666;\n}\n\n.add-icon {\n  font-size: 40rpx;\n  margin-right: 0;\n}\n\n.add-text {\n  display: none;\n}\n\n.add-task-input {\n  margin: 20rpx;\n  border: 1rpx solid #f0f0f0;\n  border-radius: 12rpx;\n  overflow: hidden;\n}\n\n.input-field {\n  height: 80rpx;\n  padding: 0 30rpx;\n  font-size: 30rpx;\n  background: #fff;\n}\n\n.confirm-btn {\n  background-color: #f8f8f8;\n}\n\n.modal {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background-color: rgba(0, 0, 0, 0.5);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 1000;\n}\n\n.modal-content {\n  width: 80%;\n  background-color: #fff;\n  border-radius: 16rpx;\n  overflow: hidden;\n}\n\n.modal-body {\n  padding: 40rpx 30rpx;\n  text-align: center;\n  font-size: 32rpx;\n}\n\n.modal-footer {\n  display: flex;\n  border-top: 1rpx solid #f0f0f0;\n}\n\n.modal-btn {\n  flex: 1;\n  text-align: center;\n  padding: 30rpx 0;\n  font-size: 32rpx;\n}\n\n.modal-btn.cancel {\n  border-right: 1rpx solid #f0f0f0;\n  color: #666;\n}\n\n.modal-btn.confirm {\n  color: #f44336;\n  font-weight: bold;\n}\n\n@keyframes slideDown {\n  from {\n    opacity: 0;\n    transform: translateY(-20px);\n  }\n  to {\n    opacity: 1;\n    transform: translateY(0);\n  }\n}\n</style>","import MiniProgramPage from 'C:/Users/25855/Desktop/狮山云瞳/狮山云瞳/狮山云瞳/狮山云瞳/pages/task-list/task-list.vue'\nwx.createPage(MiniProgramPage)"],"names":["request","uni"],"mappings":"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"}