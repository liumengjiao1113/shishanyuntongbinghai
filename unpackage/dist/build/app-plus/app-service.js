if("undefined"==typeof Promise||Promise.prototype.finally||(Promise.prototype.finally=function(e){const t=this.constructor;return this.then((i=>t.resolve(e()).then((()=>i))),(i=>t.resolve(e()).then((()=>{throw i}))))}),"undefined"!=typeof uni&&uni&&uni.requireGlobal){const e=uni.requireGlobal();ArrayBuffer=e.ArrayBuffer,Int8Array=e.Int8Array,Uint8Array=e.Uint8Array,Uint8ClampedArray=e.Uint8ClampedArray,Int16Array=e.Int16Array,Uint16Array=e.Uint16Array,Int32Array=e.Int32Array,Uint32Array=e.Uint32Array,Float32Array=e.Float32Array,Float64Array=e.Float64Array,BigInt64Array=e.BigInt64Array,BigUint64Array=e.BigUint64Array}uni.restoreGlobal&&uni.restoreGlobal(Vue,weex,plus,setTimeout,clearTimeout,setInterval,clearInterval),function(e){"use strict";function t(e,t,...i){uni.__log__?uni.__log__(e,t,...i):console[e].apply(console,[...i,t])}function i(e){return"0123456789abcdefghijklmnopqrstuvwxyz".charAt(e)}function s(e,t){return e&t}function n(e,t){return e|t}function o(e,t){return e^t}function a(e,t){return e&~t}function r(e){if(0==e)return-1;var t=0;return 65535&e||(e>>=16,t+=16),255&e||(e>>=8,t+=8),15&e||(e>>=4,t+=4),3&e||(e>>=2,t+=2),1&e||++t,t}function l(e){for(var t=0;0!=e;)e&=e-1,++t;return t}var c,h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function d(e){var t,i,s="";for(t=0;t+3<=e.length;t+=3)i=parseInt(e.substring(t,t+3),16),s+=h.charAt(i>>6)+h.charAt(63&i);for(t+1==e.length?(i=parseInt(e.substring(t,t+1),16),s+=h.charAt(i<<2)):t+2==e.length&&(i=parseInt(e.substring(t,t+2),16),s+=h.charAt(i>>2)+h.charAt((3&i)<<4));(3&s.length)>0;)s+="=";return s}function u(e){var t,s="",n=0,o=0;for(t=0;t<e.length&&"="!=e.charAt(t);++t){var a=h.indexOf(e.charAt(t));a<0||(0==n?(s+=i(a>>2),o=3&a,n=1):1==n?(s+=i(o<<2|a>>4),o=15&a,n=2):2==n?(s+=i(o),s+=i(a>>2),o=3&a,n=3):(s+=i(o<<2|a>>4),s+=i(15&a),n=0))}return 1==n&&(s+=i(o<<2)),s}var m,p=function(e){var t;if(void 0===c){var i="0123456789ABCDEF",s=" \f\n\r\t \u2028\u2029";for(c={},t=0;t<16;++t)c[i.charAt(t)]=t;for(i=i.toLowerCase(),t=10;t<16;++t)c[i.charAt(t)]=t;for(t=0;t<8;++t)c[s.charAt(t)]=-1}var n=[],o=0,a=0;for(t=0;t<e.length;++t){var r=e.charAt(t);if("="==r)break;if(-1!=(r=c[r])){if(void 0===r)throw new Error("Illegal character at offset "+t);o|=r,++a>=2?(n[n.length]=o,o=0,a=0):o<<=4}}if(a)throw new Error("Hex encoding incomplete: 4 bits missing");return n},g={decode:function(e){var t;if(void 0===m){var i="= \f\n\r\t \u2028\u2029";for(m=Object.create(null),t=0;t<64;++t)m["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(t)]=t;for(m["-"]=62,m._=63,t=0;t<9;++t)m[i.charAt(t)]=-1}var s=[],n=0,o=0;for(t=0;t<e.length;++t){var a=e.charAt(t);if("="==a)break;if(-1!=(a=m[a])){if(void 0===a)throw new Error("Illegal character at offset "+t);n|=a,++o>=4?(s[s.length]=n>>16,s[s.length]=n>>8&255,s[s.length]=255&n,n=0,o=0):n<<=6}}switch(o){case 1:throw new Error("Base64 encoding incomplete: at least 2 bits missing");case 2:s[s.length]=n>>10;break;case 3:s[s.length]=n>>16,s[s.length]=n>>8&255}return s},re:/-----BEGIN [^-]+-----([A-Za-z0-9+\/=\s]+)-----END [^-]+-----|begin-base64[^\n]+\n([A-Za-z0-9+\/=\s]+)====/,unarmor:function(e){var t=g.re.exec(e);if(t)if(t[1])e=t[1];else{if(!t[2])throw new Error("RegExp out of sync");e=t[2]}return g.decode(e)}},f=1e13,v=function(){function e(e){this.buf=[+e||0]}return e.prototype.mulAdd=function(e,t){var i,s,n=this.buf,o=n.length;for(i=0;i<o;++i)(s=n[i]*e+t)<f?t=0:s-=(t=0|s/f)*f,n[i]=s;t>0&&(n[i]=t)},e.prototype.sub=function(e){var t,i,s=this.buf,n=s.length;for(t=0;t<n;++t)(i=s[t]-e)<0?(i+=f,e=1):e=0,s[t]=i;for(;0===s[s.length-1];)s.pop()},e.prototype.toString=function(e){if(10!=(e||10))throw new Error("only base 10 is supported");for(var t=this.buf,i=t[t.length-1].toString(),s=t.length-2;s>=0;--s)i+=(f+t[s]).toString().substring(1);return i},e.prototype.valueOf=function(){for(var e=this.buf,t=0,i=e.length-1;i>=0;--i)t=t*f+e[i];return t},e.prototype.simplify=function(){var e=this.buf;return 1==e.length?e[0]:this},e}(),y=/^(\d\d)(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])([01]\d|2[0-3])(?:([0-5]\d)(?:([0-5]\d)(?:[.,](\d{1,3}))?)?)?(Z|[-+](?:[0]\d|1[0-2])([0-5]\d)?)?$/,w=/^(\d\d\d\d)(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])([01]\d|2[0-3])(?:([0-5]\d)(?:([0-5]\d)(?:[.,](\d{1,3}))?)?)?(Z|[-+](?:[0]\d|1[0-2])([0-5]\d)?)?$/;function k(e,t){return e.length>t&&(e=e.substring(0,t)+"…"),e}var E,b=function(){function e(t,i){this.hexDigits="0123456789ABCDEF",t instanceof e?(this.enc=t.enc,this.pos=t.pos):(this.enc=t,this.pos=i)}return e.prototype.get=function(e){if(void 0===e&&(e=this.pos++),e>=this.enc.length)throw new Error("Requesting byte offset ".concat(e," on a stream of length ").concat(this.enc.length));return"string"==typeof this.enc?this.enc.charCodeAt(e):this.enc[e]},e.prototype.hexByte=function(e){return this.hexDigits.charAt(e>>4&15)+this.hexDigits.charAt(15&e)},e.prototype.hexDump=function(e,t,i){for(var s="",n=e;n<t;++n)if(s+=this.hexByte(this.get(n)),!0!==i)switch(15&n){case 7:s+="  ";break;case 15:s+="\n";break;default:s+=" "}return s},e.prototype.isASCII=function(e,t){for(var i=e;i<t;++i){var s=this.get(i);if(s<32||s>176)return!1}return!0},e.prototype.parseStringISO=function(e,t){for(var i="",s=e;s<t;++s)i+=String.fromCharCode(this.get(s));return i},e.prototype.parseStringUTF=function(e,t){for(var i="",s=e;s<t;){var n=this.get(s++);i+=n<128?String.fromCharCode(n):n>191&&n<224?String.fromCharCode((31&n)<<6|63&this.get(s++)):String.fromCharCode((15&n)<<12|(63&this.get(s++))<<6|63&this.get(s++))}return i},e.prototype.parseStringBMP=function(e,t){for(var i,s,n="",o=e;o<t;)i=this.get(o++),s=this.get(o++),n+=String.fromCharCode(i<<8|s);return n},e.prototype.parseTime=function(e,t,i){var s=this.parseStringISO(e,t),n=(i?y:w).exec(s);return n?(i&&(n[1]=+n[1],n[1]+=+n[1]<70?2e3:1900),s=n[1]+"-"+n[2]+"-"+n[3]+" "+n[4],n[5]&&(s+=":"+n[5],n[6]&&(s+=":"+n[6],n[7]&&(s+="."+n[7]))),n[8]&&(s+=" UTC","Z"!=n[8]&&(s+=n[8],n[9]&&(s+=":"+n[9]))),s):"Unrecognized time: "+s},e.prototype.parseInteger=function(e,t){for(var i,s=this.get(e),n=s>127,o=n?255:0,a="";s==o&&++e<t;)s=this.get(e);if(0===(i=t-e))return n?-1:0;if(i>4){for(a=s,i<<=3;!(128&(+a^o));)a=+a<<1,--i;a="("+i+" bit)\n"}n&&(s-=256);for(var r=new v(s),l=e+1;l<t;++l)r.mulAdd(256,this.get(l));return a+r.toString()},e.prototype.parseBitString=function(e,t,i){for(var s=this.get(e),n="("+((t-e-1<<3)-s)+" bit)\n",o="",a=e+1;a<t;++a){for(var r=this.get(a),l=a==t-1?s:0,c=7;c>=l;--c)o+=r>>c&1?"1":"0";if(o.length>i)return n+k(o,i)}return n+o},e.prototype.parseOctetString=function(e,t,i){if(this.isASCII(e,t))return k(this.parseStringISO(e,t),i);var s=t-e,n="("+s+" byte)\n";s>(i/=2)&&(t=e+i);for(var o=e;o<t;++o)n+=this.hexByte(this.get(o));return s>i&&(n+="…"),n},e.prototype.parseOID=function(e,t,i){for(var s="",n=new v,o=0,a=e;a<t;++a){var r=this.get(a);if(n.mulAdd(128,127&r),o+=7,!(128&r)){if(""===s)if((n=n.simplify())instanceof v)n.sub(80),s="2."+n.toString();else{var l=n<80?n<40?0:1:2;s=l+"."+(n-40*l)}else s+="."+n.toString();if(s.length>i)return k(s,i);n=new v,o=0}}return o>0&&(s+=".incomplete"),s},e}(),N=function(){function e(e,t,i,s,n){if(!(s instanceof T))throw new Error("Invalid tag value.");this.stream=e,this.header=t,this.length=i,this.tag=s,this.sub=n}return e.prototype.typeName=function(){switch(this.tag.tagClass){case 0:switch(this.tag.tagNumber){case 0:return"EOC";case 1:return"BOOLEAN";case 2:return"INTEGER";case 3:return"BIT_STRING";case 4:return"OCTET_STRING";case 5:return"NULL";case 6:return"OBJECT_IDENTIFIER";case 7:return"ObjectDescriptor";case 8:return"EXTERNAL";case 9:return"REAL";case 10:return"ENUMERATED";case 11:return"EMBEDDED_PDV";case 12:return"UTF8String";case 16:return"SEQUENCE";case 17:return"SET";case 18:return"NumericString";case 19:return"PrintableString";case 20:return"TeletexString";case 21:return"VideotexString";case 22:return"IA5String";case 23:return"UTCTime";case 24:return"GeneralizedTime";case 25:return"GraphicString";case 26:return"VisibleString";case 27:return"GeneralString";case 28:return"UniversalString";case 30:return"BMPString"}return"Universal_"+this.tag.tagNumber.toString();case 1:return"Application_"+this.tag.tagNumber.toString();case 2:return"["+this.tag.tagNumber.toString()+"]";case 3:return"Private_"+this.tag.tagNumber.toString()}},e.prototype.content=function(e){if(void 0===this.tag)return null;void 0===e&&(e=1/0);var t=this.posContent(),i=Math.abs(this.length);if(!this.tag.isUniversal())return null!==this.sub?"("+this.sub.length+" elem)":this.stream.parseOctetString(t,t+i,e);switch(this.tag.tagNumber){case 1:return 0===this.stream.get(t)?"false":"true";case 2:return this.stream.parseInteger(t,t+i);case 3:return this.sub?"("+this.sub.length+" elem)":this.stream.parseBitString(t,t+i,e);case 4:return this.sub?"("+this.sub.length+" elem)":this.stream.parseOctetString(t,t+i,e);case 6:return this.stream.parseOID(t,t+i,e);case 16:case 17:return null!==this.sub?"("+this.sub.length+" elem)":"(no elem)";case 12:return k(this.stream.parseStringUTF(t,t+i),e);case 18:case 19:case 20:case 21:case 22:case 26:return k(this.stream.parseStringISO(t,t+i),e);case 30:return k(this.stream.parseStringBMP(t,t+i),e);case 23:case 24:return this.stream.parseTime(t,t+i,23==this.tag.tagNumber)}return null},e.prototype.toString=function(){return this.typeName()+"@"+this.stream.pos+"[header:"+this.header+",length:"+this.length+",sub:"+(null===this.sub?"null":this.sub.length)+"]"},e.prototype.toPrettyString=function(e){void 0===e&&(e="");var t=e+this.typeName()+" @"+this.stream.pos;if(this.length>=0&&(t+="+"),t+=this.length,this.tag.tagConstructed?t+=" (constructed)":!this.tag.isUniversal()||3!=this.tag.tagNumber&&4!=this.tag.tagNumber||null===this.sub||(t+=" (encapsulates)"),t+="\n",null!==this.sub){e+="  ";for(var i=0,s=this.sub.length;i<s;++i)t+=this.sub[i].toPrettyString(e)}return t},e.prototype.posStart=function(){return this.stream.pos},e.prototype.posContent=function(){return this.stream.pos+this.header},e.prototype.posEnd=function(){return this.stream.pos+this.header+Math.abs(this.length)},e.prototype.toHexString=function(){return this.stream.hexDump(this.posStart(),this.posEnd(),!0)},e.decodeLength=function(e){var t=e.get(),i=127&t;if(i==t)return i;if(i>6)throw new Error("Length over 48 bits not supported at position "+(e.pos-1));if(0===i)return null;t=0;for(var s=0;s<i;++s)t=256*t+e.get();return t},e.prototype.getHexStringValue=function(){var e=this.toHexString(),t=2*this.header,i=2*this.length;return e.substr(t,i)},e.decode=function(t){var i;i=t instanceof b?t:new b(t,0);var s=new b(i),n=new T(i),o=e.decodeLength(i),a=i.pos,r=a-s.pos,l=null,c=function(){var t=[];if(null!==o){for(var s=a+o;i.pos<s;)t[t.length]=e.decode(i);if(i.pos!=s)throw new Error("Content size is not correct for container starting at offset "+a)}else try{for(;;){var n=e.decode(i);if(n.tag.isEOC())break;t[t.length]=n}o=a-i.pos}catch(r){throw new Error("Exception while decoding undefined length content: "+r)}return t};if(n.tagConstructed)l=c();else if(n.isUniversal()&&(3==n.tagNumber||4==n.tagNumber))try{if(3==n.tagNumber&&0!=i.get())throw new Error("BIT STRINGs with unused bits cannot encapsulate.");l=c();for(var h=0;h<l.length;++h)if(l[h].tag.isEOC())throw new Error("EOC is not supposed to be actual content.")}catch(d){l=null}if(null===l){if(null===o)throw new Error("We can't skip over an invalid tag with undefined length at offset "+a);i.pos=a+Math.abs(o)}return new e(s,r,o,n,l)},e}(),T=function(){function e(e){var t=e.get();if(this.tagClass=t>>6,this.tagConstructed=!!(32&t),this.tagNumber=31&t,31==this.tagNumber){var i=new v;do{t=e.get(),i.mulAdd(128,127&t)}while(128&t);this.tagNumber=i.simplify()}}return e.prototype.isUniversal=function(){return 0===this.tagClass},e.prototype.isEOC=function(){return 0===this.tagClass&&0===this.tagNumber},e}(),S=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],V=(1<<26)/S[S.length-1],D=function(){function e(e,t,i){null!=e&&("number"==typeof e?this.fromNumber(e,t,i):null==t&&"string"!=typeof e?this.fromString(e,256):this.fromString(e,t))}return e.prototype.toString=function(e){if(this.s<0)return"-"+this.negate().toString(e);var t;if(16==e)t=4;else if(8==e)t=3;else if(2==e)t=1;else if(32==e)t=5;else{if(4!=e)return this.toRadix(e);t=2}var s,n=(1<<t)-1,o=!1,a="",r=this.t,l=this.DB-r*this.DB%t;if(r-- >0)for(l<this.DB&&(s=this[r]>>l)>0&&(o=!0,a=i(s));r>=0;)l<t?(s=(this[r]&(1<<l)-1)<<t-l,s|=this[--r]>>(l+=this.DB-t)):(s=this[r]>>(l-=t)&n,l<=0&&(l+=this.DB,--r)),s>0&&(o=!0),o&&(a+=i(s));return o?a:"0"},e.prototype.negate=function(){var t=A();return e.ZERO.subTo(this,t),t},e.prototype.abs=function(){return this.s<0?this.negate():this},e.prototype.compareTo=function(e){var t=this.s-e.s;if(0!=t)return t;var i=this.t;if(0!=(t=i-e.t))return this.s<0?-t:t;for(;--i>=0;)if(0!=(t=this[i]-e[i]))return t;return 0},e.prototype.bitLength=function(){return this.t<=0?0:this.DB*(this.t-1)+F(this[this.t-1]^this.s&this.DM)},e.prototype.mod=function(t){var i=A();return this.abs().divRemTo(t,null,i),this.s<0&&i.compareTo(e.ZERO)>0&&t.subTo(i,i),i},e.prototype.modPowInt=function(e,t){var i;return i=e<256||t.isEven()?new I(t):new B(t),this.exp(e,i)},e.prototype.clone=function(){var e=A();return this.copyTo(e),e},e.prototype.intValue=function(){if(this.s<0){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]},e.prototype.byteValue=function(){return 0==this.t?this.s:this[0]<<24>>24},e.prototype.shortValue=function(){return 0==this.t?this.s:this[0]<<16>>16},e.prototype.signum=function(){return this.s<0?-1:this.t<=0||1==this.t&&this[0]<=0?0:1},e.prototype.toByteArray=function(){var e=this.t,t=[];t[0]=this.s;var i,s=this.DB-e*this.DB%8,n=0;if(e-- >0)for(s<this.DB&&(i=this[e]>>s)!=(this.s&this.DM)>>s&&(t[n++]=i|this.s<<this.DB-s);e>=0;)s<8?(i=(this[e]&(1<<s)-1)<<8-s,i|=this[--e]>>(s+=this.DB-8)):(i=this[e]>>(s-=8)&255,s<=0&&(s+=this.DB,--e)),128&i&&(i|=-256),0==n&&(128&this.s)!=(128&i)&&++n,(n>0||i!=this.s)&&(t[n++]=i);return t},e.prototype.equals=function(e){return 0==this.compareTo(e)},e.prototype.min=function(e){return this.compareTo(e)<0?this:e},e.prototype.max=function(e){return this.compareTo(e)>0?this:e},e.prototype.and=function(e){var t=A();return this.bitwiseTo(e,s,t),t},e.prototype.or=function(e){var t=A();return this.bitwiseTo(e,n,t),t},e.prototype.xor=function(e){var t=A();return this.bitwiseTo(e,o,t),t},e.prototype.andNot=function(e){var t=A();return this.bitwiseTo(e,a,t),t},e.prototype.not=function(){for(var e=A(),t=0;t<this.t;++t)e[t]=this.DM&~this[t];return e.t=this.t,e.s=~this.s,e},e.prototype.shiftLeft=function(e){var t=A();return e<0?this.rShiftTo(-e,t):this.lShiftTo(e,t),t},e.prototype.shiftRight=function(e){var t=A();return e<0?this.lShiftTo(-e,t):this.rShiftTo(e,t),t},e.prototype.getLowestSetBit=function(){for(var e=0;e<this.t;++e)if(0!=this[e])return e*this.DB+r(this[e]);return this.s<0?this.t*this.DB:-1},e.prototype.bitCount=function(){for(var e=0,t=this.s&this.DM,i=0;i<this.t;++i)e+=l(this[i]^t);return e},e.prototype.testBit=function(e){var t=Math.floor(e/this.DB);return t>=this.t?0!=this.s:!!(this[t]&1<<e%this.DB)},e.prototype.setBit=function(e){return this.changeBit(e,n)},e.prototype.clearBit=function(e){return this.changeBit(e,a)},e.prototype.flipBit=function(e){return this.changeBit(e,o)},e.prototype.add=function(e){var t=A();return this.addTo(e,t),t},e.prototype.subtract=function(e){var t=A();return this.subTo(e,t),t},e.prototype.multiply=function(e){var t=A();return this.multiplyTo(e,t),t},e.prototype.divide=function(e){var t=A();return this.divRemTo(e,t,null),t},e.prototype.remainder=function(e){var t=A();return this.divRemTo(e,null,t),t},e.prototype.divideAndRemainder=function(e){var t=A(),i=A();return this.divRemTo(e,t,i),[t,i]},e.prototype.modPow=function(e,t){var i,s,n=e.bitLength(),o=_(1);if(n<=0)return o;i=n<18?1:n<48?3:n<144?4:n<768?5:6,s=n<8?new I(t):t.isEven()?new C(t):new B(t);var a=[],r=3,l=i-1,c=(1<<i)-1;if(a[1]=s.convert(this),i>1){var h=A();for(s.sqrTo(a[1],h);r<=c;)a[r]=A(),s.mulTo(h,a[r-2],a[r]),r+=2}var d,u,m=e.t-1,p=!0,g=A();for(n=F(e[m])-1;m>=0;){for(n>=l?d=e[m]>>n-l&c:(d=(e[m]&(1<<n+1)-1)<<l-n,m>0&&(d|=e[m-1]>>this.DB+n-l)),r=i;!(1&d);)d>>=1,--r;if((n-=r)<0&&(n+=this.DB,--m),p)a[d].copyTo(o),p=!1;else{for(;r>1;)s.sqrTo(o,g),s.sqrTo(g,o),r-=2;r>0?s.sqrTo(o,g):(u=o,o=g,g=u),s.mulTo(g,a[d],o)}for(;m>=0&&!(e[m]&1<<n);)s.sqrTo(o,g),u=o,o=g,g=u,--n<0&&(n=this.DB-1,--m)}return s.revert(o)},e.prototype.modInverse=function(t){var i=t.isEven();if(this.isEven()&&i||0==t.signum())return e.ZERO;for(var s=t.clone(),n=this.clone(),o=_(1),a=_(0),r=_(0),l=_(1);0!=s.signum();){for(;s.isEven();)s.rShiftTo(1,s),i?(o.isEven()&&a.isEven()||(o.addTo(this,o),a.subTo(t,a)),o.rShiftTo(1,o)):a.isEven()||a.subTo(t,a),a.rShiftTo(1,a);for(;n.isEven();)n.rShiftTo(1,n),i?(r.isEven()&&l.isEven()||(r.addTo(this,r),l.subTo(t,l)),r.rShiftTo(1,r)):l.isEven()||l.subTo(t,l),l.rShiftTo(1,l);s.compareTo(n)>=0?(s.subTo(n,s),i&&o.subTo(r,o),a.subTo(l,a)):(n.subTo(s,n),i&&r.subTo(o,r),l.subTo(a,l))}return 0!=n.compareTo(e.ONE)?e.ZERO:l.compareTo(t)>=0?l.subtract(t):l.signum()<0?(l.addTo(t,l),l.signum()<0?l.add(t):l):l},e.prototype.pow=function(e){return this.exp(e,new x)},e.prototype.gcd=function(e){var t=this.s<0?this.negate():this.clone(),i=e.s<0?e.negate():e.clone();if(t.compareTo(i)<0){var s=t;t=i,i=s}var n=t.getLowestSetBit(),o=i.getLowestSetBit();if(o<0)return t;for(n<o&&(o=n),o>0&&(t.rShiftTo(o,t),i.rShiftTo(o,i));t.signum()>0;)(n=t.getLowestSetBit())>0&&t.rShiftTo(n,t),(n=i.getLowestSetBit())>0&&i.rShiftTo(n,i),t.compareTo(i)>=0?(t.subTo(i,t),t.rShiftTo(1,t)):(i.subTo(t,i),i.rShiftTo(1,i));return o>0&&i.lShiftTo(o,i),i},e.prototype.isProbablePrime=function(e){var t,i=this.abs();if(1==i.t&&i[0]<=S[S.length-1]){for(t=0;t<S.length;++t)if(i[0]==S[t])return!0;return!1}if(i.isEven())return!1;for(t=1;t<S.length;){for(var s=S[t],n=t+1;n<S.length&&s<V;)s*=S[n++];for(s=i.modInt(s);t<n;)if(s%S[t++]==0)return!1}return i.millerRabin(e)},e.prototype.copyTo=function(e){for(var t=this.t-1;t>=0;--t)e[t]=this[t];e.t=this.t,e.s=this.s},e.prototype.fromInt=function(e){this.t=1,this.s=e<0?-1:0,e>0?this[0]=e:e<-1?this[0]=e+this.DV:this.t=0},e.prototype.fromString=function(t,i){var s;if(16==i)s=4;else if(8==i)s=3;else if(256==i)s=8;else if(2==i)s=1;else if(32==i)s=5;else{if(4!=i)return void this.fromRadix(t,i);s=2}this.t=0,this.s=0;for(var n=t.length,o=!1,a=0;--n>=0;){var r=8==s?255&+t[n]:U(t,n);r<0?"-"==t.charAt(n)&&(o=!0):(o=!1,0==a?this[this.t++]=r:a+s>this.DB?(this[this.t-1]|=(r&(1<<this.DB-a)-1)<<a,this[this.t++]=r>>this.DB-a):this[this.t-1]|=r<<a,(a+=s)>=this.DB&&(a-=this.DB))}8==s&&128&+t[0]&&(this.s=-1,a>0&&(this[this.t-1]|=(1<<this.DB-a)-1<<a)),this.clamp(),o&&e.ZERO.subTo(this,this)},e.prototype.clamp=function(){for(var e=this.s&this.DM;this.t>0&&this[this.t-1]==e;)--this.t},e.prototype.dlShiftTo=function(e,t){var i;for(i=this.t-1;i>=0;--i)t[i+e]=this[i];for(i=e-1;i>=0;--i)t[i]=0;t.t=this.t+e,t.s=this.s},e.prototype.drShiftTo=function(e,t){for(var i=e;i<this.t;++i)t[i-e]=this[i];t.t=Math.max(this.t-e,0),t.s=this.s},e.prototype.lShiftTo=function(e,t){for(var i=e%this.DB,s=this.DB-i,n=(1<<s)-1,o=Math.floor(e/this.DB),a=this.s<<i&this.DM,r=this.t-1;r>=0;--r)t[r+o+1]=this[r]>>s|a,a=(this[r]&n)<<i;for(r=o-1;r>=0;--r)t[r]=0;t[o]=a,t.t=this.t+o+1,t.s=this.s,t.clamp()},e.prototype.rShiftTo=function(e,t){t.s=this.s;var i=Math.floor(e/this.DB);if(i>=this.t)t.t=0;else{var s=e%this.DB,n=this.DB-s,o=(1<<s)-1;t[0]=this[i]>>s;for(var a=i+1;a<this.t;++a)t[a-i-1]|=(this[a]&o)<<n,t[a-i]=this[a]>>s;s>0&&(t[this.t-i-1]|=(this.s&o)<<n),t.t=this.t-i,t.clamp()}},e.prototype.subTo=function(e,t){for(var i=0,s=0,n=Math.min(e.t,this.t);i<n;)s+=this[i]-e[i],t[i++]=s&this.DM,s>>=this.DB;if(e.t<this.t){for(s-=e.s;i<this.t;)s+=this[i],t[i++]=s&this.DM,s>>=this.DB;s+=this.s}else{for(s+=this.s;i<e.t;)s-=e[i],t[i++]=s&this.DM,s>>=this.DB;s-=e.s}t.s=s<0?-1:0,s<-1?t[i++]=this.DV+s:s>0&&(t[i++]=s),t.t=i,t.clamp()},e.prototype.multiplyTo=function(t,i){var s=this.abs(),n=t.abs(),o=s.t;for(i.t=o+n.t;--o>=0;)i[o]=0;for(o=0;o<n.t;++o)i[o+s.t]=s.am(0,n[o],i,o,0,s.t);i.s=0,i.clamp(),this.s!=t.s&&e.ZERO.subTo(i,i)},e.prototype.squareTo=function(e){for(var t=this.abs(),i=e.t=2*t.t;--i>=0;)e[i]=0;for(i=0;i<t.t-1;++i){var s=t.am(i,t[i],e,2*i,0,1);(e[i+t.t]+=t.am(i+1,2*t[i],e,2*i+1,s,t.t-i-1))>=t.DV&&(e[i+t.t]-=t.DV,e[i+t.t+1]=1)}e.t>0&&(e[e.t-1]+=t.am(i,t[i],e,2*i,0,1)),e.s=0,e.clamp()},e.prototype.divRemTo=function(t,i,s){var n=t.abs();if(!(n.t<=0)){var o=this.abs();if(o.t<n.t)return null!=i&&i.fromInt(0),void(null!=s&&this.copyTo(s));null==s&&(s=A());var a=A(),r=this.s,l=t.s,c=this.DB-F(n[n.t-1]);c>0?(n.lShiftTo(c,a),o.lShiftTo(c,s)):(n.copyTo(a),o.copyTo(s));var h=a.t,d=a[h-1];if(0!=d){var u=d*(1<<this.F1)+(h>1?a[h-2]>>this.F2:0),m=this.FV/u,p=(1<<this.F1)/u,g=1<<this.F2,f=s.t,v=f-h,y=null==i?A():i;for(a.dlShiftTo(v,y),s.compareTo(y)>=0&&(s[s.t++]=1,s.subTo(y,s)),e.ONE.dlShiftTo(h,y),y.subTo(a,a);a.t<h;)a[a.t++]=0;for(;--v>=0;){var w=s[--f]==d?this.DM:Math.floor(s[f]*m+(s[f-1]+g)*p);if((s[f]+=a.am(0,w,s,v,0,h))<w)for(a.dlShiftTo(v,y),s.subTo(y,s);s[f]<--w;)s.subTo(y,s)}null!=i&&(s.drShiftTo(h,i),r!=l&&e.ZERO.subTo(i,i)),s.t=h,s.clamp(),c>0&&s.rShiftTo(c,s),r<0&&e.ZERO.subTo(s,s)}}},e.prototype.invDigit=function(){if(this.t<1)return 0;var e=this[0];if(!(1&e))return 0;var t=3&e;return(t=(t=(t=(t=t*(2-(15&e)*t)&15)*(2-(255&e)*t)&255)*(2-((65535&e)*t&65535))&65535)*(2-e*t%this.DV)%this.DV)>0?this.DV-t:-t},e.prototype.isEven=function(){return 0==(this.t>0?1&this[0]:this.s)},e.prototype.exp=function(t,i){if(t>4294967295||t<1)return e.ONE;var s=A(),n=A(),o=i.convert(this),a=F(t)-1;for(o.copyTo(s);--a>=0;)if(i.sqrTo(s,n),(t&1<<a)>0)i.mulTo(n,o,s);else{var r=s;s=n,n=r}return i.revert(s)},e.prototype.chunkSize=function(e){return Math.floor(Math.LN2*this.DB/Math.log(e))},e.prototype.toRadix=function(e){if(null==e&&(e=10),0==this.signum()||e<2||e>36)return"0";var t=this.chunkSize(e),i=Math.pow(e,t),s=_(i),n=A(),o=A(),a="";for(this.divRemTo(s,n,o);n.signum()>0;)a=(i+o.intValue()).toString(e).substr(1)+a,n.divRemTo(s,n,o);return o.intValue().toString(e)+a},e.prototype.fromRadix=function(t,i){this.fromInt(0),null==i&&(i=10);for(var s=this.chunkSize(i),n=Math.pow(i,s),o=!1,a=0,r=0,l=0;l<t.length;++l){var c=U(t,l);c<0?"-"==t.charAt(l)&&0==this.signum()&&(o=!0):(r=i*r+c,++a>=s&&(this.dMultiply(n),this.dAddOffset(r,0),a=0,r=0))}a>0&&(this.dMultiply(Math.pow(i,a)),this.dAddOffset(r,0)),o&&e.ZERO.subTo(this,this)},e.prototype.fromNumber=function(t,i,s){if("number"==typeof i)if(t<2)this.fromInt(1);else for(this.fromNumber(t,s),this.testBit(t-1)||this.bitwiseTo(e.ONE.shiftLeft(t-1),n,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(i);)this.dAddOffset(2,0),this.bitLength()>t&&this.subTo(e.ONE.shiftLeft(t-1),this);else{var o=[],a=7&t;o.length=1+(t>>3),i.nextBytes(o),a>0?o[0]&=(1<<a)-1:o[0]=0,this.fromString(o,256)}},e.prototype.bitwiseTo=function(e,t,i){var s,n,o=Math.min(e.t,this.t);for(s=0;s<o;++s)i[s]=t(this[s],e[s]);if(e.t<this.t){for(n=e.s&this.DM,s=o;s<this.t;++s)i[s]=t(this[s],n);i.t=this.t}else{for(n=this.s&this.DM,s=o;s<e.t;++s)i[s]=t(n,e[s]);i.t=e.t}i.s=t(this.s,e.s),i.clamp()},e.prototype.changeBit=function(t,i){var s=e.ONE.shiftLeft(t);return this.bitwiseTo(s,i,s),s},e.prototype.addTo=function(e,t){for(var i=0,s=0,n=Math.min(e.t,this.t);i<n;)s+=this[i]+e[i],t[i++]=s&this.DM,s>>=this.DB;if(e.t<this.t){for(s+=e.s;i<this.t;)s+=this[i],t[i++]=s&this.DM,s>>=this.DB;s+=this.s}else{for(s+=this.s;i<e.t;)s+=e[i],t[i++]=s&this.DM,s>>=this.DB;s+=e.s}t.s=s<0?-1:0,s>0?t[i++]=s:s<-1&&(t[i++]=this.DV+s),t.t=i,t.clamp()},e.prototype.dMultiply=function(e){this[this.t]=this.am(0,e-1,this,0,0,this.t),++this.t,this.clamp()},e.prototype.dAddOffset=function(e,t){if(0!=e){for(;this.t<=t;)this[this.t++]=0;for(this[t]+=e;this[t]>=this.DV;)this[t]-=this.DV,++t>=this.t&&(this[this.t++]=0),++this[t]}},e.prototype.multiplyLowerTo=function(e,t,i){var s=Math.min(this.t+e.t,t);for(i.s=0,i.t=s;s>0;)i[--s]=0;for(var n=i.t-this.t;s<n;++s)i[s+this.t]=this.am(0,e[s],i,s,0,this.t);for(n=Math.min(e.t,t);s<n;++s)this.am(0,e[s],i,s,0,t-s);i.clamp()},e.prototype.multiplyUpperTo=function(e,t,i){--t;var s=i.t=this.t+e.t-t;for(i.s=0;--s>=0;)i[s]=0;for(s=Math.max(t-this.t,0);s<e.t;++s)i[this.t+s-t]=this.am(t-s,e[s],i,0,0,this.t+s-t);i.clamp(),i.drShiftTo(1,i)},e.prototype.modInt=function(e){if(e<=0)return 0;var t=this.DV%e,i=this.s<0?e-1:0;if(this.t>0)if(0==t)i=this[0]%e;else for(var s=this.t-1;s>=0;--s)i=(t*i+this[s])%e;return i},e.prototype.millerRabin=function(t){var i=this.subtract(e.ONE),s=i.getLowestSetBit();if(s<=0)return!1;var n=i.shiftRight(s);(t=t+1>>1)>S.length&&(t=S.length);for(var o=A(),a=0;a<t;++a){o.fromInt(S[Math.floor(Math.random()*S.length)]);var r=o.modPow(n,this);if(0!=r.compareTo(e.ONE)&&0!=r.compareTo(i)){for(var l=1;l++<s&&0!=r.compareTo(i);)if(0==(r=r.modPowInt(2,this)).compareTo(e.ONE))return!1;if(0!=r.compareTo(i))return!1}}return!0},e.prototype.square=function(){var e=A();return this.squareTo(e),e},e.prototype.gcda=function(e,t){var i=this.s<0?this.negate():this.clone(),s=e.s<0?e.negate():e.clone();if(i.compareTo(s)<0){var n=i;i=s,s=n}var o=i.getLowestSetBit(),a=s.getLowestSetBit();if(a<0)t(i);else{o<a&&(a=o),a>0&&(i.rShiftTo(a,i),s.rShiftTo(a,s));var r=function(){(o=i.getLowestSetBit())>0&&i.rShiftTo(o,i),(o=s.getLowestSetBit())>0&&s.rShiftTo(o,s),i.compareTo(s)>=0?(i.subTo(s,i),i.rShiftTo(1,i)):(s.subTo(i,s),s.rShiftTo(1,s)),i.signum()>0?setTimeout(r,0):(a>0&&s.lShiftTo(a,s),setTimeout((function(){t(s)}),0))};setTimeout(r,10)}},e.prototype.fromNumberAsync=function(t,i,s,o){if("number"==typeof i)if(t<2)this.fromInt(1);else{this.fromNumber(t,s),this.testBit(t-1)||this.bitwiseTo(e.ONE.shiftLeft(t-1),n,this),this.isEven()&&this.dAddOffset(1,0);var a=this,r=function(){a.dAddOffset(2,0),a.bitLength()>t&&a.subTo(e.ONE.shiftLeft(t-1),a),a.isProbablePrime(i)?setTimeout((function(){o()}),0):setTimeout(r,0)};setTimeout(r,0)}else{var l=[],c=7&t;l.length=1+(t>>3),i.nextBytes(l),c>0?l[0]&=(1<<c)-1:l[0]=0,this.fromString(l,256)}},e}(),x=function(){function e(){}return e.prototype.convert=function(e){return e},e.prototype.revert=function(e){return e},e.prototype.mulTo=function(e,t,i){e.multiplyTo(t,i)},e.prototype.sqrTo=function(e,t){e.squareTo(t)},e}(),I=function(){function e(e){this.m=e}return e.prototype.convert=function(e){return e.s<0||e.compareTo(this.m)>=0?e.mod(this.m):e},e.prototype.revert=function(e){return e},e.prototype.reduce=function(e){e.divRemTo(this.m,null,e)},e.prototype.mulTo=function(e,t,i){e.multiplyTo(t,i),this.reduce(i)},e.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)},e}(),B=function(){function e(e){this.m=e,this.mp=e.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<e.DB-15)-1,this.mt2=2*e.t}return e.prototype.convert=function(e){var t=A();return e.abs().dlShiftTo(this.m.t,t),t.divRemTo(this.m,null,t),e.s<0&&t.compareTo(D.ZERO)>0&&this.m.subTo(t,t),t},e.prototype.revert=function(e){var t=A();return e.copyTo(t),this.reduce(t),t},e.prototype.reduce=function(e){for(;e.t<=this.mt2;)e[e.t++]=0;for(var t=0;t<this.m.t;++t){var i=32767&e[t],s=i*this.mpl+((i*this.mph+(e[t]>>15)*this.mpl&this.um)<<15)&e.DM;for(e[i=t+this.m.t]+=this.m.am(0,s,e,t,0,this.m.t);e[i]>=e.DV;)e[i]-=e.DV,e[++i]++}e.clamp(),e.drShiftTo(this.m.t,e),e.compareTo(this.m)>=0&&e.subTo(this.m,e)},e.prototype.mulTo=function(e,t,i){e.multiplyTo(t,i),this.reduce(i)},e.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)},e}(),C=function(){function e(e){this.m=e,this.r2=A(),this.q3=A(),D.ONE.dlShiftTo(2*e.t,this.r2),this.mu=this.r2.divide(e)}return e.prototype.convert=function(e){if(e.s<0||e.t>2*this.m.t)return e.mod(this.m);if(e.compareTo(this.m)<0)return e;var t=A();return e.copyTo(t),this.reduce(t),t},e.prototype.revert=function(e){return e},e.prototype.reduce=function(e){for(e.drShiftTo(this.m.t-1,this.r2),e.t>this.m.t+1&&(e.t=this.m.t+1,e.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);e.compareTo(this.r2)<0;)e.dAddOffset(1,this.m.t+1);for(e.subTo(this.r2,e);e.compareTo(this.m)>=0;)e.subTo(this.m,e)},e.prototype.mulTo=function(e,t,i){e.multiplyTo(t,i),this.reduce(i)},e.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)},e}();function A(){return new D(null)}function P(e,t){return new D(e,t)}var R="undefined"!=typeof navigator;R&&"Microsoft Internet Explorer"==navigator.appName?(D.prototype.am=function(e,t,i,s,n,o){for(var a=32767&t,r=t>>15;--o>=0;){var l=32767&this[e],c=this[e++]>>15,h=r*l+c*a;n=((l=a*l+((32767&h)<<15)+i[s]+(1073741823&n))>>>30)+(h>>>15)+r*c+(n>>>30),i[s++]=1073741823&l}return n},E=30):R&&"Netscape"!=navigator.appName?(D.prototype.am=function(e,t,i,s,n,o){for(;--o>=0;){var a=t*this[e++]+i[s]+n;n=Math.floor(a/67108864),i[s++]=67108863&a}return n},E=26):(D.prototype.am=function(e,t,i,s,n,o){for(var a=16383&t,r=t>>14;--o>=0;){var l=16383&this[e],c=this[e++]>>14,h=r*l+c*a;n=((l=a*l+((16383&h)<<14)+i[s]+n)>>28)+(h>>14)+r*c,i[s++]=268435455&l}return n},E=28),D.prototype.DB=E,D.prototype.DM=(1<<E)-1,D.prototype.DV=1<<E;D.prototype.FV=Math.pow(2,52),D.prototype.F1=52-E,D.prototype.F2=2*E-52;var L,O,M=[];for(L="0".charCodeAt(0),O=0;O<=9;++O)M[L++]=O;for(L="a".charCodeAt(0),O=10;O<36;++O)M[L++]=O;for(L="A".charCodeAt(0),O=10;O<36;++O)M[L++]=O;function U(e,t){var i=M[e.charCodeAt(t)];return null==i?-1:i}function _(e){var t=A();return t.fromInt(e),t}function F(e){var t,i=1;return 0!=(t=e>>>16)&&(e=t,i+=16),0!=(t=e>>8)&&(e=t,i+=8),0!=(t=e>>4)&&(e=t,i+=4),0!=(t=e>>2)&&(e=t,i+=2),0!=(t=e>>1)&&(e=t,i+=1),i}D.ZERO=_(0),D.ONE=_(1);var q=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,62,0,62,0,63,52,53,54,55,56,57,58,59,60,61,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,0,0,0,0,63,0,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51];const j={getRandomValues(e){if(!(e instanceof Int8Array||e instanceof Uint8Array||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Uint8ClampedArray))throw new Error("Expected an integer array");if(e.byteLength>65536)throw new Error("Can only request a maximum of 65536 bytes");var t;return function(e,t){for(var i,s=e.length,n="="===e[s-2]?2:"="===e[s-1]?1:0,o=0,a=s-n&4294967292,r=0;r<a;r+=4)i=q[e.charCodeAt(r)]<<18|q[e.charCodeAt(r+1)]<<12|q[e.charCodeAt(r+2)]<<6|q[e.charCodeAt(r+3)],t[o++]=i>>16&255,t[o++]=i>>8&255,t[o++]=255&i;1===n&&(i=q[e.charCodeAt(r)]<<10|q[e.charCodeAt(r+1)]<<4|q[e.charCodeAt(r+2)]>>2,t[o++]=i>>8&255,t[o++]=255&i),2===n&&(i=q[e.charCodeAt(r)]<<2|q[e.charCodeAt(r+1)]>>4,t[o++]=255&i)}((t="DCloud-Crypto",weex.requireModule(t)).getRandomValues(e.byteLength),new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),e}};var $=function(){function e(){this.i=0,this.j=0,this.S=[]}return e.prototype.init=function(e){var t,i,s;for(t=0;t<256;++t)this.S[t]=t;for(i=0,t=0;t<256;++t)i=i+this.S[t]+e[t%e.length]&255,s=this.S[t],this.S[t]=this.S[i],this.S[i]=s;this.i=0,this.j=0},e.prototype.next=function(){var e;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,e=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=e,this.S[e+this.S[this.i]&255]},e}();var H,z,K=null;if(null==K){K=[],z=0;var G=void 0;if("undefined"!=typeof window&&j&&j.getRandomValues){var Z=new Uint32Array(256);for(j.getRandomValues(Z),G=0;G<Z.length;++G)K[z++]=255&Z[G]}var W=0,J=function(e){if((W=W||0)>=256||z>=256)window.removeEventListener?window.removeEventListener("mousemove",J,!1):window.detachEvent&&window.detachEvent("onmousemove",J);else try{var t=e.x+e.y;K[z++]=255&t,W+=1}catch(i){}};"undefined"!=typeof window&&(window.addEventListener?window.addEventListener("mousemove",J,!1):window.attachEvent&&window.attachEvent("onmousemove",J))}function X(){if(null==H){for(H=new $;z<256;){var e=Math.floor(65536*Math.random());K[z++]=255&e}for(H.init(K),z=0;z<K.length;++z)K[z]=0;z=0}return H.next()}var Y=function(){function e(){}return e.prototype.nextBytes=function(e){for(var t=0;t<e.length;++t)e[t]=X()},e}();var Q=function(){function e(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}return e.prototype.doPublic=function(e){return e.modPowInt(this.e,this.n)},e.prototype.doPrivate=function(e){if(null==this.p||null==this.q)return e.modPow(this.d,this.n);for(var t=e.mod(this.p).modPow(this.dmp1,this.p),i=e.mod(this.q).modPow(this.dmq1,this.q);t.compareTo(i)<0;)t=t.add(this.p);return t.subtract(i).multiply(this.coeff).mod(this.p).multiply(this.q).add(i)},e.prototype.setPublic=function(e,i){null!=e&&null!=i&&e.length>0&&i.length>0?(this.n=P(e,16),this.e=parseInt(i,16)):t("error","at node_modules/jsencrypt/lib/lib/jsbn/rsa.js:114","Invalid RSA public key")},e.prototype.encrypt=function(e){var i=this.n.bitLength()+7>>3,s=function(e,i){if(i<e.length+11)return t("error","at node_modules/jsencrypt/lib/lib/jsbn/rsa.js:37","Message too long for RSA"),null;for(var s=[],n=e.length-1;n>=0&&i>0;){var o=e.charCodeAt(n--);o<128?s[--i]=o:o>127&&o<2048?(s[--i]=63&o|128,s[--i]=o>>6|192):(s[--i]=63&o|128,s[--i]=o>>6&63|128,s[--i]=o>>12|224)}s[--i]=0;for(var a=new Y,r=[];i>2;){for(r[0]=0;0==r[0];)a.nextBytes(r);s[--i]=r[0]}return s[--i]=2,s[--i]=0,new D(s)}(e,i);if(null==s)return null;var n=this.doPublic(s);if(null==n)return null;for(var o=n.toString(16),a=o.length,r=0;r<2*i-a;r++)o="0"+o;return o},e.prototype.setPrivate=function(e,i,s){null!=e&&null!=i&&e.length>0&&i.length>0?(this.n=P(e,16),this.e=parseInt(i,16),this.d=P(s,16)):t("error","at node_modules/jsencrypt/lib/lib/jsbn/rsa.js:146","Invalid RSA private key")},e.prototype.setPrivateEx=function(e,i,s,n,o,a,r,l){null!=e&&null!=i&&e.length>0&&i.length>0?(this.n=P(e,16),this.e=parseInt(i,16),this.d=P(s,16),this.p=P(n,16),this.q=P(o,16),this.dmp1=P(a,16),this.dmq1=P(r,16),this.coeff=P(l,16)):t("error","at node_modules/jsencrypt/lib/lib/jsbn/rsa.js:163","Invalid RSA private key")},e.prototype.generate=function(e,t){var i=new Y,s=e>>1;this.e=parseInt(t,16);for(var n=new D(t,16);;){for(;this.p=new D(e-s,1,i),0!=this.p.subtract(D.ONE).gcd(n).compareTo(D.ONE)||!this.p.isProbablePrime(10););for(;this.q=new D(s,1,i),0!=this.q.subtract(D.ONE).gcd(n).compareTo(D.ONE)||!this.q.isProbablePrime(10););if(this.p.compareTo(this.q)<=0){var o=this.p;this.p=this.q,this.q=o}var a=this.p.subtract(D.ONE),r=this.q.subtract(D.ONE),l=a.multiply(r);if(0==l.gcd(n).compareTo(D.ONE)){this.n=this.p.multiply(this.q),this.d=n.modInverse(l),this.dmp1=this.d.mod(a),this.dmq1=this.d.mod(r),this.coeff=this.q.modInverse(this.p);break}}},e.prototype.decrypt=function(e){var t=P(e,16),i=this.doPrivate(t);return null==i?null:function(e,t){var i=e.toByteArray(),s=0;for(;s<i.length&&0==i[s];)++s;if(i.length-s!=t-1||2!=i[s])return null;++s;for(;0!=i[s];)if(++s>=i.length)return null;var n="";for(;++s<i.length;){var o=255&i[s];o<128?n+=String.fromCharCode(o):o>191&&o<224?(n+=String.fromCharCode((31&o)<<6|63&i[s+1]),++s):(n+=String.fromCharCode((15&o)<<12|(63&i[s+1])<<6|63&i[s+2]),s+=2)}return n}(i,this.n.bitLength()+7>>3)},e.prototype.generateAsync=function(e,t,i){var s=new Y,n=e>>1;this.e=parseInt(t,16);var o=new D(t,16),a=this,r=function(){var t=function(){if(a.p.compareTo(a.q)<=0){var e=a.p;a.p=a.q,a.q=e}var t=a.p.subtract(D.ONE),s=a.q.subtract(D.ONE),n=t.multiply(s);0==n.gcd(o).compareTo(D.ONE)?(a.n=a.p.multiply(a.q),a.d=o.modInverse(n),a.dmp1=a.d.mod(t),a.dmq1=a.d.mod(s),a.coeff=a.q.modInverse(a.p),setTimeout((function(){i()}),0)):setTimeout(r,0)},l=function(){a.q=A(),a.q.fromNumberAsync(n,1,s,(function(){a.q.subtract(D.ONE).gcda(o,(function(e){0==e.compareTo(D.ONE)&&a.q.isProbablePrime(10)?setTimeout(t,0):setTimeout(l,0)}))}))},c=function(){a.p=A(),a.p.fromNumberAsync(e-n,1,s,(function(){a.p.subtract(D.ONE).gcda(o,(function(e){0==e.compareTo(D.ONE)&&a.p.isProbablePrime(10)?setTimeout(l,0):setTimeout(c,0)}))}))};setTimeout(c,0)};setTimeout(r,0)},e.prototype.sign=function(e,i,s){var n=function(e,i){if(i<e.length+22)return t("error","at node_modules/jsencrypt/lib/lib/jsbn/rsa.js:23","Message too long for RSA"),null;for(var s=i-e.length-6,n="",o=0;o<s;o+=2)n+="ff";return P("0001"+n+"00"+e,16)}((ee[s]||"")+i(e).toString(),this.n.bitLength()/4);if(null==n)return null;var o=this.doPrivate(n);if(null==o)return null;var a=o.toString(16);return 1&a.length?"0"+a:a},e.prototype.verify=function(e,t,i){var s=P(t,16),n=this.doPublic(s);return null==n?null:function(e){for(var t in ee)if(ee.hasOwnProperty(t)){var i=ee[t],s=i.length;if(e.substr(0,s)==i)return e.substr(s)}return e}
/*!
  Copyright (c) 2011, Yahoo! Inc. All rights reserved.
  Code licensed under the BSD License:
  http://developer.yahoo.com/yui/license.html
  version: 2.9.0
  */(n.toString(16).replace(/^1f+00/,""))==i(e).toString()},e}();var ee={md2:"3020300c06082a864886f70d020205000410",md5:"3020300c06082a864886f70d020505000410",sha1:"3021300906052b0e03021a05000414",sha224:"302d300d06096086480165030402040500041c",sha256:"3031300d060960864801650304020105000420",sha384:"3041300d060960864801650304020205000430",sha512:"3051300d060960864801650304020305000440",ripemd160:"3021300906052b2403020105000414"};var te={};te.lang={extend:function(e,t,i){if(!t||!e)throw new Error("YAHOO.lang.extend failed, please check that all dependencies are included.");var s=function(){};if(s.prototype=t.prototype,e.prototype=new s,e.prototype.constructor=e,e.superclass=t.prototype,t.prototype.constructor==Object.prototype.constructor&&(t.prototype.constructor=t),i){var n;for(n in i)e.prototype[n]=i[n];var o=function(){},a=["toString","valueOf"];try{/MSIE/.test(navigator.userAgent)&&(o=function(e,t){for(n=0;n<a.length;n+=1){var i=a[n],s=t[i];"function"==typeof s&&s!=Object.prototype[i]&&(e[i]=s)}})}catch(r){}o(e.prototype,i)}}};
/**
   * @fileOverview
   * @name asn1-1.0.js
   * @author Kenji Urushima kenji.urushima@gmail.com
   * @version asn1 1.0.13 (2017-Jun-02)
   * @since jsrsasign 2.1
   * @license <a href="https://kjur.github.io/jsrsasign/license/">MIT License</a>
   */
var ie={};void 0!==ie.asn1&&ie.asn1||(ie.asn1={}),ie.asn1.ASN1Util=new function(){this.integerToByteHex=function(e){var t=e.toString(16);return t.length%2==1&&(t="0"+t),t},this.bigIntToMinTwosComplementsHex=function(e){var t=e.toString(16);if("-"!=t.substr(0,1))t.length%2==1?t="0"+t:t.match(/^[0-7]/)||(t="00"+t);else{var i=t.substr(1).length;i%2==1?i+=1:t.match(/^[0-7]/)||(i+=2);for(var s="",n=0;n<i;n++)s+="f";t=new D(s,16).xor(e).add(D.ONE).toString(16).replace(/^-/,"")}return t},this.getPEMStringFromHex=function(e,t){return hextopem(e,t)},this.newObject=function(e){var t=ie.asn1,i=t.DERBoolean,s=t.DERInteger,n=t.DERBitString,o=t.DEROctetString,a=t.DERNull,r=t.DERObjectIdentifier,l=t.DEREnumerated,c=t.DERUTF8String,h=t.DERNumericString,d=t.DERPrintableString,u=t.DERTeletexString,m=t.DERIA5String,p=t.DERUTCTime,g=t.DERGeneralizedTime,f=t.DERSequence,v=t.DERSet,y=t.DERTaggedObject,w=t.ASN1Util.newObject,k=Object.keys(e);if(1!=k.length)throw"key of param shall be only one.";var E=k[0];if(-1==":bool:int:bitstr:octstr:null:oid:enum:utf8str:numstr:prnstr:telstr:ia5str:utctime:gentime:seq:set:tag:".indexOf(":"+E+":"))throw"undefined key: "+E;if("bool"==E)return new i(e[E]);if("int"==E)return new s(e[E]);if("bitstr"==E)return new n(e[E]);if("octstr"==E)return new o(e[E]);if("null"==E)return new a(e[E]);if("oid"==E)return new r(e[E]);if("enum"==E)return new l(e[E]);if("utf8str"==E)return new c(e[E]);if("numstr"==E)return new h(e[E]);if("prnstr"==E)return new d(e[E]);if("telstr"==E)return new u(e[E]);if("ia5str"==E)return new m(e[E]);if("utctime"==E)return new p(e[E]);if("gentime"==E)return new g(e[E]);if("seq"==E){for(var b=e[E],N=[],T=0;T<b.length;T++){var S=w(b[T]);N.push(S)}return new f({array:N})}if("set"==E){for(b=e[E],N=[],T=0;T<b.length;T++){S=w(b[T]);N.push(S)}return new v({array:N})}if("tag"==E){var V=e[E];if("[object Array]"===Object.prototype.toString.call(V)&&3==V.length){var D=w(V[2]);return new y({tag:V[0],explicit:V[1],obj:D})}var x={};if(void 0!==V.explicit&&(x.explicit=V.explicit),void 0!==V.tag&&(x.tag=V.tag),void 0===V.obj)throw"obj shall be specified for 'tag'.";return x.obj=w(V.obj),new y(x)}},this.jsonToASN1HEX=function(e){return this.newObject(e).getEncodedHex()}},ie.asn1.ASN1Util.oidHexToInt=function(e){for(var t="",i=parseInt(e.substr(0,2),16),s=(t=Math.floor(i/40)+"."+i%40,""),n=2;n<e.length;n+=2){var o=("00000000"+parseInt(e.substr(n,2),16).toString(2)).slice(-8);if(s+=o.substr(1,7),"0"==o.substr(0,1))t=t+"."+new D(s,2).toString(10),s=""}return t},ie.asn1.ASN1Util.oidIntToHex=function(e){var t=function(e){var t=e.toString(16);return 1==t.length&&(t="0"+t),t},i=function(e){var i="",s=new D(e,10).toString(2),n=7-s.length%7;7==n&&(n=0);for(var o="",a=0;a<n;a++)o+="0";s=o+s;for(a=0;a<s.length-1;a+=7){var r=s.substr(a,7);a!=s.length-7&&(r="1"+r),i+=t(parseInt(r,2))}return i};if(!e.match(/^[0-9.]+$/))throw"malformed oid string: "+e;var s="",n=e.split("."),o=40*parseInt(n[0])+parseInt(n[1]);s+=t(o),n.splice(0,2);for(var a=0;a<n.length;a++)s+=i(n[a]);return s},ie.asn1.ASN1Object=function(){this.getLengthHexFromValue=function(){if(void 0===this.hV||null==this.hV)throw"this.hV is null or undefined.";if(this.hV.length%2==1)throw"value hex must be even length: n=0,v="+this.hV;var e=this.hV.length/2,t=e.toString(16);if(t.length%2==1&&(t="0"+t),e<128)return t;var i=t.length/2;if(i>15)throw"ASN.1 length too long to represent by 8x: n = "+e.toString(16);return(128+i).toString(16)+t},this.getEncodedHex=function(){return(null==this.hTLV||this.isModified)&&(this.hV=this.getFreshValueHex(),this.hL=this.getLengthHexFromValue(),this.hTLV=this.hT+this.hL+this.hV,this.isModified=!1),this.hTLV},this.getValueHex=function(){return this.getEncodedHex(),this.hV},this.getFreshValueHex=function(){return""}},ie.asn1.DERAbstractString=function(e){ie.asn1.DERAbstractString.superclass.constructor.call(this),this.getString=function(){return this.s},this.setString=function(e){this.hTLV=null,this.isModified=!0,this.s=e,this.hV=stohex(this.s)},this.setStringHex=function(e){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=e},this.getFreshValueHex=function(){return this.hV},void 0!==e&&("string"==typeof e?this.setString(e):void 0!==e.str?this.setString(e.str):void 0!==e.hex&&this.setStringHex(e.hex))},te.lang.extend(ie.asn1.DERAbstractString,ie.asn1.ASN1Object),ie.asn1.DERAbstractTime=function(e){ie.asn1.DERAbstractTime.superclass.constructor.call(this),this.localDateToUTC=function(e){return utc=e.getTime()+6e4*e.getTimezoneOffset(),new Date(utc)},this.formatDate=function(e,t,i){var s=this.zeroPadding,n=this.localDateToUTC(e),o=String(n.getFullYear());"utc"==t&&(o=o.substr(2,2));var a=o+s(String(n.getMonth()+1),2)+s(String(n.getDate()),2)+s(String(n.getHours()),2)+s(String(n.getMinutes()),2)+s(String(n.getSeconds()),2);if(!0===i){var r=n.getMilliseconds();if(0!=r){var l=s(String(r),3);a=a+"."+(l=l.replace(/[0]+$/,""))}}return a+"Z"},this.zeroPadding=function(e,t){return e.length>=t?e:new Array(t-e.length+1).join("0")+e},this.getString=function(){return this.s},this.setString=function(e){this.hTLV=null,this.isModified=!0,this.s=e,this.hV=stohex(e)},this.setByDateValue=function(e,t,i,s,n,o){var a=new Date(Date.UTC(e,t-1,i,s,n,o,0));this.setByDate(a)},this.getFreshValueHex=function(){return this.hV}},te.lang.extend(ie.asn1.DERAbstractTime,ie.asn1.ASN1Object),ie.asn1.DERAbstractStructured=function(e){ie.asn1.DERAbstractString.superclass.constructor.call(this),this.setByASN1ObjectArray=function(e){this.hTLV=null,this.isModified=!0,this.asn1Array=e},this.appendASN1Object=function(e){this.hTLV=null,this.isModified=!0,this.asn1Array.push(e)},this.asn1Array=new Array,void 0!==e&&void 0!==e.array&&(this.asn1Array=e.array)},te.lang.extend(ie.asn1.DERAbstractStructured,ie.asn1.ASN1Object),ie.asn1.DERBoolean=function(){ie.asn1.DERBoolean.superclass.constructor.call(this),this.hT="01",this.hTLV="0101ff"},te.lang.extend(ie.asn1.DERBoolean,ie.asn1.ASN1Object),ie.asn1.DERInteger=function(e){ie.asn1.DERInteger.superclass.constructor.call(this),this.hT="02",this.setByBigInteger=function(e){this.hTLV=null,this.isModified=!0,this.hV=ie.asn1.ASN1Util.bigIntToMinTwosComplementsHex(e)},this.setByInteger=function(e){var t=new D(String(e),10);this.setByBigInteger(t)},this.setValueHex=function(e){this.hV=e},this.getFreshValueHex=function(){return this.hV},void 0!==e&&(void 0!==e.bigint?this.setByBigInteger(e.bigint):void 0!==e.int?this.setByInteger(e.int):"number"==typeof e?this.setByInteger(e):void 0!==e.hex&&this.setValueHex(e.hex))},te.lang.extend(ie.asn1.DERInteger,ie.asn1.ASN1Object),ie.asn1.DERBitString=function(e){if(void 0!==e&&void 0!==e.obj){var t=ie.asn1.ASN1Util.newObject(e.obj);e.hex="00"+t.getEncodedHex()}ie.asn1.DERBitString.superclass.constructor.call(this),this.hT="03",this.setHexValueIncludingUnusedBits=function(e){this.hTLV=null,this.isModified=!0,this.hV=e},this.setUnusedBitsAndHexValue=function(e,t){if(e<0||7<e)throw"unused bits shall be from 0 to 7: u = "+e;var i="0"+e;this.hTLV=null,this.isModified=!0,this.hV=i+t},this.setByBinaryString=function(e){var t=8-(e=e.replace(/0+$/,"")).length%8;8==t&&(t=0);for(var i=0;i<=t;i++)e+="0";var s="";for(i=0;i<e.length-1;i+=8){var n=e.substr(i,8),o=parseInt(n,2).toString(16);1==o.length&&(o="0"+o),s+=o}this.hTLV=null,this.isModified=!0,this.hV="0"+t+s},this.setByBooleanArray=function(e){for(var t="",i=0;i<e.length;i++)1==e[i]?t+="1":t+="0";this.setByBinaryString(t)},this.newFalseArray=function(e){for(var t=new Array(e),i=0;i<e;i++)t[i]=!1;return t},this.getFreshValueHex=function(){return this.hV},void 0!==e&&("string"==typeof e&&e.toLowerCase().match(/^[0-9a-f]+$/)?this.setHexValueIncludingUnusedBits(e):void 0!==e.hex?this.setHexValueIncludingUnusedBits(e.hex):void 0!==e.bin?this.setByBinaryString(e.bin):void 0!==e.array&&this.setByBooleanArray(e.array))},te.lang.extend(ie.asn1.DERBitString,ie.asn1.ASN1Object),ie.asn1.DEROctetString=function(e){if(void 0!==e&&void 0!==e.obj){var t=ie.asn1.ASN1Util.newObject(e.obj);e.hex=t.getEncodedHex()}ie.asn1.DEROctetString.superclass.constructor.call(this,e),this.hT="04"},te.lang.extend(ie.asn1.DEROctetString,ie.asn1.DERAbstractString),ie.asn1.DERNull=function(){ie.asn1.DERNull.superclass.constructor.call(this),this.hT="05",this.hTLV="0500"},te.lang.extend(ie.asn1.DERNull,ie.asn1.ASN1Object),ie.asn1.DERObjectIdentifier=function(e){var t=function(e){var t=e.toString(16);return 1==t.length&&(t="0"+t),t},i=function(e){var i="",s=new D(e,10).toString(2),n=7-s.length%7;7==n&&(n=0);for(var o="",a=0;a<n;a++)o+="0";s=o+s;for(a=0;a<s.length-1;a+=7){var r=s.substr(a,7);a!=s.length-7&&(r="1"+r),i+=t(parseInt(r,2))}return i};ie.asn1.DERObjectIdentifier.superclass.constructor.call(this),this.hT="06",this.setValueHex=function(e){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=e},this.setValueOidString=function(e){if(!e.match(/^[0-9.]+$/))throw"malformed oid string: "+e;var s="",n=e.split("."),o=40*parseInt(n[0])+parseInt(n[1]);s+=t(o),n.splice(0,2);for(var a=0;a<n.length;a++)s+=i(n[a]);this.hTLV=null,this.isModified=!0,this.s=null,this.hV=s},this.setValueName=function(e){var t=ie.asn1.x509.OID.name2oid(e);if(""===t)throw"DERObjectIdentifier oidName undefined: "+e;this.setValueOidString(t)},this.getFreshValueHex=function(){return this.hV},void 0!==e&&("string"==typeof e?e.match(/^[0-2].[0-9.]+$/)?this.setValueOidString(e):this.setValueName(e):void 0!==e.oid?this.setValueOidString(e.oid):void 0!==e.hex?this.setValueHex(e.hex):void 0!==e.name&&this.setValueName(e.name))},te.lang.extend(ie.asn1.DERObjectIdentifier,ie.asn1.ASN1Object),ie.asn1.DEREnumerated=function(e){ie.asn1.DEREnumerated.superclass.constructor.call(this),this.hT="0a",this.setByBigInteger=function(e){this.hTLV=null,this.isModified=!0,this.hV=ie.asn1.ASN1Util.bigIntToMinTwosComplementsHex(e)},this.setByInteger=function(e){var t=new D(String(e),10);this.setByBigInteger(t)},this.setValueHex=function(e){this.hV=e},this.getFreshValueHex=function(){return this.hV},void 0!==e&&(void 0!==e.int?this.setByInteger(e.int):"number"==typeof e?this.setByInteger(e):void 0!==e.hex&&this.setValueHex(e.hex))},te.lang.extend(ie.asn1.DEREnumerated,ie.asn1.ASN1Object),ie.asn1.DERUTF8String=function(e){ie.asn1.DERUTF8String.superclass.constructor.call(this,e),this.hT="0c"},te.lang.extend(ie.asn1.DERUTF8String,ie.asn1.DERAbstractString),ie.asn1.DERNumericString=function(e){ie.asn1.DERNumericString.superclass.constructor.call(this,e),this.hT="12"},te.lang.extend(ie.asn1.DERNumericString,ie.asn1.DERAbstractString),ie.asn1.DERPrintableString=function(e){ie.asn1.DERPrintableString.superclass.constructor.call(this,e),this.hT="13"},te.lang.extend(ie.asn1.DERPrintableString,ie.asn1.DERAbstractString),ie.asn1.DERTeletexString=function(e){ie.asn1.DERTeletexString.superclass.constructor.call(this,e),this.hT="14"},te.lang.extend(ie.asn1.DERTeletexString,ie.asn1.DERAbstractString),ie.asn1.DERIA5String=function(e){ie.asn1.DERIA5String.superclass.constructor.call(this,e),this.hT="16"},te.lang.extend(ie.asn1.DERIA5String,ie.asn1.DERAbstractString),ie.asn1.DERUTCTime=function(e){ie.asn1.DERUTCTime.superclass.constructor.call(this,e),this.hT="17",this.setByDate=function(e){this.hTLV=null,this.isModified=!0,this.date=e,this.s=this.formatDate(this.date,"utc"),this.hV=stohex(this.s)},this.getFreshValueHex=function(){return void 0===this.date&&void 0===this.s&&(this.date=new Date,this.s=this.formatDate(this.date,"utc"),this.hV=stohex(this.s)),this.hV},void 0!==e&&(void 0!==e.str?this.setString(e.str):"string"==typeof e&&e.match(/^[0-9]{12}Z$/)?this.setString(e):void 0!==e.hex?this.setStringHex(e.hex):void 0!==e.date&&this.setByDate(e.date))},te.lang.extend(ie.asn1.DERUTCTime,ie.asn1.DERAbstractTime),ie.asn1.DERGeneralizedTime=function(e){ie.asn1.DERGeneralizedTime.superclass.constructor.call(this,e),this.hT="18",this.withMillis=!1,this.setByDate=function(e){this.hTLV=null,this.isModified=!0,this.date=e,this.s=this.formatDate(this.date,"gen",this.withMillis),this.hV=stohex(this.s)},this.getFreshValueHex=function(){return void 0===this.date&&void 0===this.s&&(this.date=new Date,this.s=this.formatDate(this.date,"gen",this.withMillis),this.hV=stohex(this.s)),this.hV},void 0!==e&&(void 0!==e.str?this.setString(e.str):"string"==typeof e&&e.match(/^[0-9]{14}Z$/)?this.setString(e):void 0!==e.hex?this.setStringHex(e.hex):void 0!==e.date&&this.setByDate(e.date),!0===e.millis&&(this.withMillis=!0))},te.lang.extend(ie.asn1.DERGeneralizedTime,ie.asn1.DERAbstractTime),ie.asn1.DERSequence=function(e){ie.asn1.DERSequence.superclass.constructor.call(this,e),this.hT="30",this.getFreshValueHex=function(){for(var e="",t=0;t<this.asn1Array.length;t++){e+=this.asn1Array[t].getEncodedHex()}return this.hV=e,this.hV}},te.lang.extend(ie.asn1.DERSequence,ie.asn1.DERAbstractStructured),ie.asn1.DERSet=function(e){ie.asn1.DERSet.superclass.constructor.call(this,e),this.hT="31",this.sortFlag=!0,this.getFreshValueHex=function(){for(var e=new Array,t=0;t<this.asn1Array.length;t++){var i=this.asn1Array[t];e.push(i.getEncodedHex())}return 1==this.sortFlag&&e.sort(),this.hV=e.join(""),this.hV},void 0!==e&&void 0!==e.sortflag&&0==e.sortflag&&(this.sortFlag=!1)},te.lang.extend(ie.asn1.DERSet,ie.asn1.DERAbstractStructured),ie.asn1.DERTaggedObject=function(e){ie.asn1.DERTaggedObject.superclass.constructor.call(this),this.hT="a0",this.hV="",this.isExplicit=!0,this.asn1Object=null,this.setASN1Object=function(e,t,i){this.hT=t,this.isExplicit=e,this.asn1Object=i,this.isExplicit?(this.hV=this.asn1Object.getEncodedHex(),this.hTLV=null,this.isModified=!0):(this.hV=null,this.hTLV=i.getEncodedHex(),this.hTLV=this.hTLV.replace(/^../,t),this.isModified=!1)},this.getFreshValueHex=function(){return this.hV},void 0!==e&&(void 0!==e.tag&&(this.hT=e.tag),void 0!==e.explicit&&(this.isExplicit=e.explicit),void 0!==e.obj&&(this.asn1Object=e.obj,this.setASN1Object(this.isExplicit,this.hT,this.asn1Object)))},te.lang.extend(ie.asn1.DERTaggedObject,ie.asn1.ASN1Object);var se,ne=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])})(t,i)};return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function s(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}(),oe=function(e){function t(i){var s=e.call(this)||this;return i&&("string"==typeof i?s.parseKey(i):(t.hasPrivateKeyProperty(i)||t.hasPublicKeyProperty(i))&&s.parsePropertiesFrom(i)),s}return ne(t,e),t.prototype.parseKey=function(e){try{var t=0,i=0,s=/^\s*(?:[0-9A-Fa-f][0-9A-Fa-f]\s*)+$/.test(e)?p(e):g.unarmor(e),n=N.decode(s);if(3===n.sub.length&&(n=n.sub[2].sub[0]),9===n.sub.length){t=n.sub[1].getHexStringValue(),this.n=P(t,16),i=n.sub[2].getHexStringValue(),this.e=parseInt(i,16);var o=n.sub[3].getHexStringValue();this.d=P(o,16);var a=n.sub[4].getHexStringValue();this.p=P(a,16);var r=n.sub[5].getHexStringValue();this.q=P(r,16);var l=n.sub[6].getHexStringValue();this.dmp1=P(l,16);var c=n.sub[7].getHexStringValue();this.dmq1=P(c,16);var h=n.sub[8].getHexStringValue();this.coeff=P(h,16)}else{if(2!==n.sub.length)return!1;if(n.sub[0].sub){var d=n.sub[1].sub[0];t=d.sub[0].getHexStringValue(),this.n=P(t,16),i=d.sub[1].getHexStringValue(),this.e=parseInt(i,16)}else t=n.sub[0].getHexStringValue(),this.n=P(t,16),i=n.sub[1].getHexStringValue(),this.e=parseInt(i,16)}return!0}catch(u){return!1}},t.prototype.getPrivateBaseKey=function(){var e={array:[new ie.asn1.DERInteger({int:0}),new ie.asn1.DERInteger({bigint:this.n}),new ie.asn1.DERInteger({int:this.e}),new ie.asn1.DERInteger({bigint:this.d}),new ie.asn1.DERInteger({bigint:this.p}),new ie.asn1.DERInteger({bigint:this.q}),new ie.asn1.DERInteger({bigint:this.dmp1}),new ie.asn1.DERInteger({bigint:this.dmq1}),new ie.asn1.DERInteger({bigint:this.coeff})]};return new ie.asn1.DERSequence(e).getEncodedHex()},t.prototype.getPrivateBaseKeyB64=function(){return d(this.getPrivateBaseKey())},t.prototype.getPublicBaseKey=function(){var e=new ie.asn1.DERSequence({array:[new ie.asn1.DERObjectIdentifier({oid:"1.2.840.113549.1.1.1"}),new ie.asn1.DERNull]}),t=new ie.asn1.DERSequence({array:[new ie.asn1.DERInteger({bigint:this.n}),new ie.asn1.DERInteger({int:this.e})]}),i=new ie.asn1.DERBitString({hex:"00"+t.getEncodedHex()});return new ie.asn1.DERSequence({array:[e,i]}).getEncodedHex()},t.prototype.getPublicBaseKeyB64=function(){return d(this.getPublicBaseKey())},t.wordwrap=function(e,t){if(!e)return e;var i="(.{1,"+(t=t||64)+"})( +|$\n?)|(.{1,"+t+"})";return e.match(RegExp(i,"g")).join("\n")},t.prototype.getPrivateKey=function(){var e="-----BEGIN RSA PRIVATE KEY-----\n";return e+=t.wordwrap(this.getPrivateBaseKeyB64())+"\n",e+="-----END RSA PRIVATE KEY-----"},t.prototype.getPublicKey=function(){var e="-----BEGIN PUBLIC KEY-----\n";return e+=t.wordwrap(this.getPublicBaseKeyB64())+"\n",e+="-----END PUBLIC KEY-----"},t.hasPublicKeyProperty=function(e){return(e=e||{}).hasOwnProperty("n")&&e.hasOwnProperty("e")},t.hasPrivateKeyProperty=function(e){return(e=e||{}).hasOwnProperty("n")&&e.hasOwnProperty("e")&&e.hasOwnProperty("d")&&e.hasOwnProperty("p")&&e.hasOwnProperty("q")&&e.hasOwnProperty("dmp1")&&e.hasOwnProperty("dmq1")&&e.hasOwnProperty("coeff")},t.prototype.parsePropertiesFrom=function(e){this.n=e.n,this.e=e.e,e.hasOwnProperty("d")&&(this.d=e.d,this.p=e.p,this.q=e.q,this.dmp1=e.dmp1,this.dmq1=e.dmq1,this.coeff=e.coeff)},t}(Q),ae="undefined"!=typeof process?null===(se={})||void 0===se?void 0:se.npm_package_version:void 0,re=function(){function e(e){void 0===e&&(e={}),e=e||{},this.default_key_size=e.default_key_size?parseInt(e.default_key_size,10):1024,this.default_public_exponent=e.default_public_exponent||"010001",this.log=e.log||!1,this.key=null}return e.prototype.setKey=function(e){this.log&&this.key&&t("warn","at node_modules/jsencrypt/lib/JSEncrypt.js:37","A key was already set, overriding existing."),this.key=new oe(e)},e.prototype.setPrivateKey=function(e){this.setKey(e)},e.prototype.setPublicKey=function(e){this.setKey(e)},e.prototype.decrypt=function(e){try{return this.getKey().decrypt(u(e))}catch(t){return!1}},e.prototype.encrypt=function(e){try{return d(this.getKey().encrypt(e))}catch(t){return!1}},e.prototype.sign=function(e,t,i){try{return d(this.getKey().sign(e,t,i))}catch(s){return!1}},e.prototype.verify=function(e,t,i){try{return this.getKey().verify(e,u(t),i)}catch(s){return!1}},e.prototype.getKey=function(e){if(!this.key){if(this.key=new oe,e&&"[object Function]"==={}.toString.call(e))return void this.key.generateAsync(this.default_key_size,this.default_public_exponent,e);this.key.generate(this.default_key_size,this.default_public_exponent)}return this.key},e.prototype.getPrivateKey=function(){return this.getKey().getPrivateKey()},e.prototype.getPrivateKeyB64=function(){return this.getKey().getPrivateBaseKeyB64()},e.prototype.getPublicKey=function(){return this.getKey().getPublicKey()},e.prototype.getPublicKeyB64=function(){return this.getKey().getPublicBaseKeyB64()},e.version=ae,e}();const le=e=>(t("log","at components/request.js:5","Request options:",e),new Promise(((t,i)=>{var s,n;let o="https://larsc.hzau.edu.cn/prod-api"+e.url;if("GET"===e.method&&e.data){let t="";for(const i in e.data)void 0!==e.data[i]&&null!==e.data[i]&&(t&&(t+="&"),t+=`${i}=${encodeURIComponent(e.data[i])}`);t&&(o+=(o.includes("?")?"&":"?")+t)}uni.request({url:o,method:e.method||"GET",data:"GET"!==e.method?e.data:void 0,header:{...e.headers,Authorization:null==(n=null==(s=e.headers)?void 0:s.Authorization)?void 0:n.trim()},success:e=>{e.statusCode>=200&&e.statusCode<300?t(e.data):i(new Error(`请求失败，状态码：${e.statusCode}`))},fail:e=>{i(new Error(`网络错误：${e.errMsg}`))}})}))),ce=(e,t)=>{const i=e.__vccOpts||e;for(const[s,n]of t)i[s]=n;return i};const he=ce({data:()=>({username:"",password:"",isLoading:!1}),methods:{handleUsernameInput(e){e.detail.value.length>20&&(this.username=e.detail.value.slice(0,20),uni.showToast({title:"用户名不能超过20位",icon:"none"}))},handlePasswordInput(e){e.detail.value.length>32&&(this.password=e.detail.value.slice(0,32),uni.showToast({title:"密码不能超过32位",icon:"none"}))},async login(){try{if(!this.username)return void uni.showToast({title:"请输入用户名",icon:"none"});if(!this.password)return void uni.showToast({title:"请输入密码",icon:"none"});const e=(await le({url:"/api/v1/auth/publicKey",method:"GET"})).data;if(!e)throw new Error("获取公钥失败");const t=new re;t.setPublicKey(e);const i=t.encrypt(this.password);if(!i)throw new Error("密码加密失败");const s=`username=${encodeURIComponent(this.username)}&password=${encodeURIComponent(i)}`,n=await le({url:`/api/v1/auth/login?${s}`,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"}});if("00000"!==n.code)throw new Error(n.msg||"登录失败");uni.setStorageSync("token",n.data.accessToken),uni.setStorageSync("username",this.username),uni.showToast({title:"登录成功",icon:"none"}),setTimeout((()=>{uni.reLaunch({url:"/pages/index/index"})}),500)}catch(e){t("error","at pages/login/login.vue:124","登录出错:",e),uni.showToast({title:e.message||"登录失败，请重试",icon:"none"})}},gooffline(){uni.reLaunch({url:"/pages/offline/offline"})}}},[["render",function(t,i,s,n,o,a){return e.openBlock(),e.createElementBlock("view",{style:{height:"100vh",background:"#fff"}},[e.createElementVNode("view",{class:"img-a"},[e.createElementVNode("view",{class:"t-b"},[e.createTextVNode(" 您好， "),e.createElementVNode("br"),e.createTextVNode(" 欢迎使用狮山云瞳小程序 "),e.createElementVNode("view",{class:"sub-title"},"病害检测专用版")])]),e.createElementVNode("view",{class:"login-view",style:{}},[e.createElementVNode("view",{class:"t-login"},[e.createElementVNode("form",{class:"cl"},[e.createElementVNode("view",{class:"t-a"},[e.createElementVNode("text",{class:"txt"},"用户名"),e.withDirectives(e.createElementVNode("input",{type:"text",name:"username",placeholder:"请输入您的用户名",maxlength:"99","onUpdate:modelValue":i[0]||(i[0]=e=>o.username=e),onInput:i[1]||(i[1]=(...e)=>a.handleUsernameInput&&a.handleUsernameInput(...e))},null,544),[[e.vModelText,o.username]])]),e.createElementVNode("view",{class:"t-a"},[e.createElementVNode("text",{class:"txt"},"密码"),e.withDirectives(e.createElementVNode("input",{type:"password",name:"password",maxlength:"99",placeholder:"请输入您的密码","onUpdate:modelValue":i[2]||(i[2]=e=>o.password=e),onInput:i[3]||(i[3]=(...e)=>a.handlePasswordInput&&a.handlePasswordInput(...e))},null,544),[[e.vModelText,o.password]])]),e.createElementVNode("button",{onClick:i[4]||(i[4]=e=>a.login())},"登 录"),e.createElementVNode("button",{onClick:i[5]||(i[5]=e=>a.gooffline()),class:"off"},"去离线")])])])])}],["__scopeId","data-v-bde906b6"]]);const de=ce({props:{current:String},data:()=>({home:"/static/tabs/home.png",homeActive:"/static/tabs/home-active.png",msg:"/static/tabs/member.png",msgActive:"/static/tabs/member-active.png"}),methods:{goTo(e){this.current!==e&&uni.reLaunch({url:`/pages/${e}/${e}`})}}},[["render",function(t,i,s,n,o,a){return e.openBlock(),e.createElementBlock("view",{class:"tab-bar"},[e.createElementVNode("view",{class:"tab-item",onClick:i[0]||(i[0]=e=>a.goTo("index"))},[e.createElementVNode("image",{src:"index"===s.current?o.homeActive:o.home},null,8,["src"]),e.createElementVNode("text",{class:e.normalizeClass({active:"index"===s.current})},"任务",2)]),e.createElementVNode("view",{class:"tab-item",onClick:i[1]||(i[1]=e=>a.goTo("message"))},[e.createElementVNode("image",{src:"message"===s.current?o.msgActive:o.msg},null,8,["src"]),e.createElementVNode("text",{class:e.normalizeClass({active:"message"===s.current})},"我的",2)])])}],["__scopeId","data-v-c1837113"]]);const ue=ce({components:{CustomTabBar:de},data:()=>({taskCategories:[{id:2,name:"病害叶片采集",value:"roast",tasks:[],loading:!1,error:null}],activeCategoryId:null,showAddTask:!1,newTaskName:"",taskCounter:4,showDeleteModal:!1,deleteTaskName:"",deleteTaskIndex:-1,deleteTaskId:null,token:uni.getStorageSync("token")}),methods:{async toggleCategory(e){if(this.activeCategoryId===e)return this.activeCategoryId=null,void(this.showAddTask=!1);this.activeCategoryId=e,this.showAddTask=!1;const t=this.taskCategories.find((t=>t.id===e));t&&(t.tasks.length>0||t.loading||await this.fetchTasks(t))},async fetchTasks(e){if(e.loading=!0,e.error=null,!this.token)return e.error="未获取到Token，请重新登录",void(e.loading=!1);try{const t=await le({url:"/branchTask/branchTaskList",method:"GET",headers:{Authorization:this.token,Accept:"*/*"},data:{currentPageCount:1,pageSize:1e4,name:""}});if(200!==t.code||!t.data||!t.data.records)throw new Error(t.msg||"获取任务失败");e.tasks=t.data.records.map((e=>({id:e.id,name:e.name,description:e.name})))}catch(i){t("error","at pages/index/index.vue:150","错误:",i),e.error=i.message||"请求失败，请重试"}finally{e.loading=!1}},goToDetail(e,t){uni.navigateTo({url:`/pages/task-detail/task-detail?id=${e.id}&type=${t}&desc=${encodeURIComponent(e.description)}`})},toggleAddTask(){this.showAddTask=!this.showAddTask,this.newTaskName=""},handleInput(){},async addTask(){if(!this.newTaskName.trim())return;const e=this.taskCategories.find((e=>e.id===this.activeCategoryId));if(e)try{e.loading=!0;const t=await le({url:"/branchTask/add",method:"POST",headers:{Authorization:this.token,"Content-Type":"application/json",Accept:"*/*"},data:{name:this.newTaskName.trim()}});if(200!==t.code)throw new Error(t.msg||"添加任务失败");await this.fetchTasks(e),this.newTaskName="",this.showAddTask=!1,uni.showToast({title:"添加任务成功",icon:"success"})}catch(i){t("error","at pages/index/index.vue:207","添加任务错误:",i),uni.showToast({title:i.message||"添加任务失败",icon:"none"})}finally{e.loading=!1}},showDeleteConfirm(e,t){this.deleteTaskName=e.name,this.deleteTaskIndex=t,this.deleteTaskId=e.id,this.showDeleteModal=!0},cancelDelete(){this.showDeleteModal=!1,this.deleteTaskName="",this.deleteTaskIndex=-1,this.deleteTaskId=null},async confirmDelete(){if(this.token)try{if("A0230"===(await le({url:`/branchTask/${this.deleteTaskId}`,method:"POST",headers:{Authorization:this.token,Accept:"*/*","User-Agent":"Apifox/1.0.0",Host:"larsc.hzau.edu.cn",Connection:"keep-alive"}})).code)return uni.showToast({title:"登录已过期",icon:"error"}),void uni.navigateTo({url:"/pages/login/login"});const e=this.taskCategories.find((e=>e.id===this.activeCategoryId));e&&e.tasks.splice(this.deleteTaskIndex,1),uni.showToast({title:"删除成功",icon:"success"})}catch(e){t("error","at pages/index/index.vue:264","删除失败:",e),uni.showToast({title:"删除失败",icon:"error"})}finally{this.showDeleteModal=!1,this.deleteTaskName="",this.deleteTaskIndex=-1,this.deleteTaskId=null}else uni.showToast({title:"请先登录",icon:"error"})}}},[["render",function(t,i,s,n,o,a){const r=e.resolveComponent("CustomTabBar");return e.openBlock(),e.createElementBlock("view",{class:"container"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.taskCategories,(t=>(e.openBlock(),e.createElementBlock("view",{key:t.id,class:"category-wrapper"},[e.createElementVNode("view",{class:"category-card",onClick:e=>a.toggleCategory(t.id)},[e.createElementVNode("text",{class:"category-title"},e.toDisplayString(t.name),1),e.createElementVNode("view",{class:e.normalizeClass(["arrow",{"is-open":o.activeCategoryId===t.id}])},null,2)],8,["onClick"]),o.activeCategoryId===t.id?(e.openBlock(),e.createElementBlock("view",{key:0,class:"task-list-container"},[t.loading?(e.openBlock(),e.createElementBlock("view",{key:0,class:"task-card empty"}," 加载中... ")):t.tasks&&t.tasks.length?(e.openBlock(!0),e.createElementBlock(e.Fragment,{key:2},e.renderList(t.tasks,((i,s)=>(e.openBlock(),e.createElementBlock("view",{key:i.id,class:"task-card",onClick:e=>a.goToDetail(i,t.value),onLongpress:e=>a.showDeleteConfirm(i,s)},[e.createElementVNode("text",{class:"task-title"},e.toDisplayString(i.name),1)],40,["onClick","onLongpress"])))),128)):(e.openBlock(),e.createElementBlock("view",{key:1,class:"task-card empty"}," 暂无任务 ")),o.showAddTask?(e.openBlock(),e.createElementBlock("view",{key:3,class:"add-task-input"},[e.withDirectives(e.createElementVNode("input",{class:"input-field","onUpdate:modelValue":i[0]||(i[0]=e=>o.newTaskName=e),placeholder:"输入任务名称","placeholder-class":"placeholder",focus:"",onInput:i[1]||(i[1]=(...e)=>a.handleInput&&a.handleInput(...e))},null,544),[[e.vModelText,o.newTaskName]]),o.newTaskName.trim()?(e.openBlock(),e.createElementBlock("view",{key:0,class:"confirm-btn",onClick:i[2]||(i[2]=(...e)=>a.addTask&&a.addTask(...e))},[e.createElementVNode("text",{class:"confirm-icon"},"✓")])):e.createCommentVNode("",!0)])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"add-task-btn",onClick:i[3]||(i[3]=(...e)=>a.toggleAddTask&&a.toggleAddTask(...e))},[e.createElementVNode("text",{class:"add-icon"},"+"),e.createElementVNode("text",{class:"add-text"},"添加任务")])])):e.createCommentVNode("",!0)])))),128)),o.showDeleteModal?(e.openBlock(),e.createElementBlock("view",{key:0,class:"modal"},[e.createElementVNode("view",{class:"modal-content"},[e.createElementVNode("view",{class:"modal-body"},[e.createElementVNode("text",null,'确定删除任务"'+e.toDisplayString(o.deleteTaskName)+'"吗？',1)]),e.createElementVNode("view",{class:"modal-footer"},[e.createElementVNode("view",{class:"modal-btn cancel",onClick:i[4]||(i[4]=(...e)=>a.cancelDelete&&a.cancelDelete(...e))},"取消"),e.createElementVNode("view",{class:"modal-btn confirm",onClick:i[5]||(i[5]=(...e)=>a.confirmDelete&&a.confirmDelete(...e))},"删除")])])])):e.createCommentVNode("",!0),e.createVNode(r,{current:"index"})])}],["__scopeId","data-v-a97b04a2"]]);const me=ce({components:{CustomTabBar:de},data:()=>({userInfo:{username:uni.getStorageSync("username")||"未登录用户"}}),methods:{uploadRecord(){uni.showToast({title:"跳转上传记录页面",icon:"none"})},logout(){uni.showModal({title:"提示",content:"确认退出登录？",success:e=>{e.confirm&&(uni.clearStorageSync(),uni.reLaunch({url:"/pages/login/login"}))}})}}},[["render",function(t,i,s,n,o,a){const r=e.resolveComponent("CustomTabBar");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("view",{class:"container"},[e.createElementVNode("view",{class:"user-info"},[e.createElementVNode("image",{class:"avatar",src:"https://example.com/default-avatar.png"}),e.createElementVNode("text",{class:"username"},e.toDisplayString(o.userInfo.username),1)]),e.createElementVNode("view",{class:"function-buttons"},[e.createElementVNode("button",{class:"btn",onClick:i[0]||(i[0]=(...e)=>a.uploadRecord&&a.uploadRecord(...e))},"上传记录"),e.createElementVNode("button",{class:"btn btn-danger",onClick:i[1]||(i[1]=(...e)=>a.logout&&a.logout(...e))},"退出登录")])]),e.createVNode(r,{current:"message"})],64)}],["__scopeId","data-v-150eed83"]]);const pe=ce({components:{CustomTabBar:de},data:()=>({taskCategories:[{id:2,name:"病害叶片采集",value:"roast",tasks:[{id:"blade_0001",taskName:"病害叶片采集-2023夏季",description:"病害叶片采集-2023夏季"}],loading:!1,error:null}],activeCategoryId:null,showAddTask:!1,newTaskName:"",taskCounter:4,showDeleteModal:!1,deleteTaskName:"",deleteTaskIndex:-1}),methods:{async toggleCategory(e){if(this.activeCategoryId===e)return this.activeCategoryId=null,void(this.showAddTask=!1);this.activeCategoryId=e,this.showAddTask=!1;const t=this.taskCategories.find((t=>t.id===e));t&&(t.tasks.length>0||t.loading||await this.fetchTasks(t))},async fetchTasks(e){e.loading=!0,e.error=null;try{const t=await le({url:"/task/getTask",method:"GET",header:{Authorization:uni.getStorageSync("token")||"","Content-Type":"application/json"},data:{typeId:e.id}});e.tasks=t.data}catch(i){t("error","at pages/task-list/task-list.vue:141","获取任务失败:",i),e.error=i.message||"获取任务失败，请稍后重试"}finally{e.loading=!1}},goToDetail(e){t("log","at pages/task-list/task-list.vue:149","即将传递的任务数据:",{id:e.id,taskName:e.taskName}),uni.navigateTo({url:`/pages/task-detail/task-detail?id=${e.id}&taskName=${encodeURIComponent(e.taskName)}`})},toggleAddTask(){this.showAddTask=!this.showAddTask,this.newTaskName=""},handleInput(){},addTask(){if(this.newTaskName.trim()){this.taskCounter++;const e=`blade_${this.taskCounter.toString().padStart(4,"0")}`,t=this.taskCategories.find((e=>e.id===this.activeCategoryId));t&&t.tasks.push({id:e,taskName:this.newTaskName,description:this.newTaskName}),this.newTaskName="",this.showAddTask=!1}},showDeleteConfirm(e,t){this.deleteTaskName=e.taskName,this.deleteTaskIndex=t,this.showDeleteModal=!0},cancelDelete(){this.showDeleteModal=!1,this.deleteTaskName="",this.deleteTaskIndex=-1},confirmDelete(){if(this.deleteTaskIndex>=0){const e=this.taskCategories.find((e=>e.id===this.activeCategoryId));e&&e.tasks.splice(this.deleteTaskIndex,1)}this.showDeleteModal=!1,this.deleteTaskName="",this.deleteTaskIndex=-1}}},[["render",function(t,i,s,n,o,a){const r=e.resolveComponent("CustomTabBar");return e.openBlock(),e.createElementBlock("view",{class:"container"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.taskCategories,(t=>(e.openBlock(),e.createElementBlock("view",{key:t.id,class:"category-wrapper"},[e.createElementVNode("view",{class:"category-card",onClick:e=>a.toggleCategory(t.id)},[e.createElementVNode("text",{class:"category-title"},e.toDisplayString(t.name),1),e.createElementVNode("view",{class:e.normalizeClass(["arrow",{"is-open":o.activeCategoryId===t.id}])},null,2)],8,["onClick"]),o.activeCategoryId===t.id?(e.openBlock(),e.createElementBlock("view",{key:0,class:"task-list-container"},[t.loading?(e.openBlock(),e.createElementBlock("view",{key:0,class:"task-card empty"}," 加载中... ")):t.tasks&&t.tasks.length?(e.openBlock(!0),e.createElementBlock(e.Fragment,{key:2},e.renderList(t.tasks,((t,i)=>(e.openBlock(),e.createElementBlock("view",{key:t.id,class:"task-card",onClick:e=>a.goToDetail(t),onLongpress:e=>a.showDeleteConfirm(t,i)},[e.createElementVNode("text",{class:"task-title"},e.toDisplayString(t.taskName),1)],40,["onClick","onLongpress"])))),128)):(e.openBlock(),e.createElementBlock("view",{key:1,class:"task-card empty"}," 暂无任务 ")),o.showAddTask?(e.openBlock(),e.createElementBlock("view",{key:3,class:"add-task-input"},[e.withDirectives(e.createElementVNode("input",{class:"input-field","onUpdate:modelValue":i[0]||(i[0]=e=>o.newTaskName=e),placeholder:"输入任务名称","placeholder-class":"placeholder",focus:"",onInput:i[1]||(i[1]=(...e)=>a.handleInput&&a.handleInput(...e))},null,544),[[e.vModelText,o.newTaskName]]),o.newTaskName.trim()?(e.openBlock(),e.createElementBlock("view",{key:0,class:"confirm-btn",onClick:i[2]||(i[2]=(...e)=>a.addTask&&a.addTask(...e))},[e.createElementVNode("text",{class:"confirm-icon"},"✓")])):e.createCommentVNode("",!0)])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"add-task-btn",onClick:i[3]||(i[3]=(...e)=>a.toggleAddTask&&a.toggleAddTask(...e))},[e.createElementVNode("text",{class:"add-icon"},"+"),e.createElementVNode("text",{class:"add-text"},"添加任务")])])):e.createCommentVNode("",!0)])))),128)),o.showDeleteModal?(e.openBlock(),e.createElementBlock("view",{key:0,class:"modal"},[e.createElementVNode("view",{class:"modal-content"},[e.createElementVNode("view",{class:"modal-body"},[e.createElementVNode("text",null,'确定删除任务"'+e.toDisplayString(o.deleteTaskName)+'"吗？',1)]),e.createElementVNode("view",{class:"modal-footer"},[e.createElementVNode("view",{class:"modal-btn cancel",onClick:i[4]||(i[4]=(...e)=>a.cancelDelete&&a.cancelDelete(...e))},"取消"),e.createElementVNode("view",{class:"modal-btn confirm",onClick:i[5]||(i[5]=(...e)=>a.confirmDelete&&a.confirmDelete(...e))},"删除")])])])):e.createCommentVNode("",!0),e.createVNode(r,{current:"index"})])}],["__scopeId","data-v-308b8313"]]);const ge=ce({data:()=>({task:{id:"1937794845536321538",taskName:"田间任务调查2",position:""},plotDescription:"",images:[],currentPage:1,pageSize:10,showNewPlotModal:!1,showUnuploadedWarning:!1,newPlotId:"",newPlotDesc:"",isSubmitting:!1,baseUrl:"https://larsc.hzau.edu.cn/prod-api",showSwitchModal:!1,loadingCells:!1,loadError:!1,errorMessage:"",totalCells:0,visibleCells:[],showDeleteDialog:!1,deleteCellInfo:{},isDeleting:!1}),computed:{totalPages(){return Math.ceil(this.totalCells/this.pageSize)},filteredImages(){const e=(this.currentPage-1)*this.pageSize,t=e+this.pageSize;return this.images.slice(e,t)}},onLoad(e){this.task.id=e.id||this.task.id,this.task.taskName=decodeURIComponent(e.desc||this.task.taskName),this.loadCells().then((()=>{if(this.visibleCells.length>0){const e=this.visibleCells[0];this.task.position=e.blockNum,this.plotDescription=e.blockName,uni.setStorageSync("blockId",e.id),uni.setStorageSync("blockNum",e.blockNum),this.loadImages()}}))},onShow(){uni.getStorageSync("blockId")&&this.loadImages()},methods:{async loadImages(){var e,i;const s=uni.getStorageSync("blockId");if(s)try{const t=uni.getStorageSync("token");if(!t)throw new Error("用户未登录");this.images=[];const n=await uni.request({url:`${this.baseUrl}/plant-disease/blockList?blockId=${s}`,method:"GET",header:{Authorization:t,Accept:"*/*"}});let o=Array.isArray(n)?n[0]:n;if(200!==o.statusCode||200!==(null==(e=o.data)?void 0:e.code))throw new Error((null==(i=o.data)?void 0:i.msg)||"加载图片数据失败");this.images=(o.data.data||[]).map((e=>({...e,imageNum:e.imageNum||`未命名_${e.id}`,selected:!1}))),this.currentPage=1}catch(n){t("error","at pages/task-detail/task-detail.vue:314","加载图片数据失败:",n),uni.showToast({title:n.message||"网络请求失败",icon:"none"})}else t("error","at pages/task-detail/task-detail.vue:276","未获取到blockId")},async handleRefresh(){uni.showLoading({title:"刷新中..."});try{await this.loadImages(),uni.showToast({title:"刷新成功",icon:"success"})}catch(e){t("error","at pages/task-detail/task-detail.vue:332","刷新失败:",e),uni.showToast({title:e.message||"刷新失败",icon:"none"})}finally{uni.hideLoading()}},selectCell(e){this.images=[],this.task.position=e.blockNum,this.plotDescription=e.blockName,uni.setStorageSync("blockId",e.id),uni.setStorageSync("blockNum",e.blockNum),this.showSwitchModal=!1,uni.showToast({title:`已切换到小区: ${e.blockNum}`,icon:"success"}),this.loadImages()},async loadImages(){var e,i;const s=uni.getStorageSync("blockId");if(s)try{const t=uni.getStorageSync("token");if(!t)throw new Error("用户未登录");const n=await uni.request({url:`${this.baseUrl}/plant-disease/blockList?blockId=${s}`,method:"GET",header:{Authorization:t,Accept:"*/*"}});let o=Array.isArray(n)?n[0]:n;if(200!==o.statusCode||200!==(null==(e=o.data)?void 0:e.code))throw new Error((null==(i=o.data)?void 0:i.msg)||"加载图片数据失败");this.images=(o.data.data||[]).map((e=>({...e,imageNum:e.imageNum||`未命名_${e.id}`})))}catch(n){t("error","at pages/task-detail/task-detail.vue:394","加载图片数据失败:",n),uni.showToast({title:n.message||"网络请求失败",icon:"none"})}},goBack(){uni.navigateBack()},toggleSelect(e){e.selected=!e.selected},getStatusText:e=>({new:"新建",started:"进行中",ended:"已完成",uploaded:"已上传",notUploaded:"未上传"}[e]||e),viewImageDetail(e){e.imageNum?uni.navigateTo({url:`/pages/result/result?taskId=${this.task.id}&taskName=${this.task.taskName}&plotId=${e.blockId||""}&plotName=${e.blockName||""}&imgId=${e.imageNum}&branchTaskId=${this.task.id}&blockId=${e.blockId||""}&imageNum=${e.imageNum}`}):uni.showToast({title:"图片编号不存在",icon:"none"})},handleView(){const e=this.images.filter((e=>e.selected));1===e.length?this.viewImageDetail(e[0]):uni.showToast({title:"请选择一张图片查看",icon:"none"})},async handleDelete(){const e=this.images.filter((e=>e.selected));0!==e.length?uni.showModal({title:"确认删除",content:`确定要删除选中的${e.length}张图片吗？`,success:async i=>{var s;if(i.confirm){const i=uni.getStorageSync("token");if(!i)return void uni.showToast({title:"请先登录",icon:"none"});for(const o of e)try{const e=await uni.request({url:`${this.baseUrl}/plant-disease/${o.id}`,method:"POST",header:{Authorization:i,Accept:"*/*"}});let n=Array.isArray(e)?e[0]:e;if(200!==n.statusCode)throw new Error((null==(s=n.data)?void 0:s.msg)||"删除图片失败");t("log","at pages/task-detail/task-detail.vue:496",`图片 ${o.id} 删除成功`)}catch(n){t("error","at pages/task-detail/task-detail.vue:501",`删除图片 ${o.id} 失败:`,n),uni.showToast({title:n.message||"删除图片失败",icon:"none"})}await this.loadImages(),uni.showToast({title:"删除成功"})}}}):uni.showToast({title:"请先选择要删除的图片",icon:"none"})},goToCollect(){uni.setStorageSync("branchTaskId",this.task.id),uni.setStorageSync("branchTaskName",this.task.taskName),uni.setStorageSync("blockNum",this.task.position),uni.setStorageSync("blockName",this.plotDescription),uni.navigateTo({url:`/pages/collect/collect?taskId=${this.task.id}`})},checkUnuploadedImages(){return this.images.some((e=>"notUploaded"===e.status))},cancelNewPlot(){this.showNewPlotModal=!1,this.showUnuploadedWarning=!1,this.newPlotId="",this.newPlotDesc="",this.isSubmitting=!1},async addNewPlot(){var e,i;try{this.isSubmitting=!0;const t=uni.getStorageSync("token");if(!t)return uni.showToast({title:"请先登录",icon:"none"}),void(this.isSubmitting=!1);const s=await uni.request({url:`${this.baseUrl}/block/add`,method:"POST",header:{Authorization:t,"Content-Type":"application/json",Accept:"*/*"},data:{branchTaskId:this.task.id,blockNum:this.newPlotId,blockName:this.newPlotDesc,remark:this.newPlotDesc}});let n=Array.isArray(s)?s[0]:s;if(200!==(null==(e=n.data)?void 0:e.code)){const e=(null==(i=n.data)?void 0:i.msg)||"创建小区失败";throw new Error(e)}this.task.position=this.newPlotId,this.plotDescription=this.newPlotDesc,this.images=[],uni.showToast({title:"小区创建成功",icon:"success"}),this.cancelNewPlot()}catch(s){t("error","at pages/task-detail/task-detail.vue:586","创建小区失败:",s),uni.showToast({title:s.message||"创建小区失败",icon:"none"})}finally{this.isSubmitting=!1}},confirmNewPlot(){this.newPlotId?this.checkUnuploadedImages()?(this.showNewPlotModal=!1,this.showUnuploadedWarning=!0):this.addNewPlot():uni.showToast({title:"请输入小区编号",icon:"none"})},forceNewPlot(){this.addNewPlot()},openSwitchModal(){this.showSwitchModal=!0,this.currentPage=1,this.loadCells()},async loadCells(){var e,i;this.loadingCells=!0,this.loadError=!1;try{const t=uni.getStorageSync("token");if(!t)throw new Error("用户未登录");const s={currentPageCount:this.currentPage,pageSize:this.pageSize,branchTaskId:this.task.id},n=await uni.request({url:`${this.baseUrl}/block/blockList`,method:"GET",header:{Authorization:t,Accept:"*/*"},data:s});let o=Array.isArray(n)?n[0]:n;if(200!==o.statusCode||200!==(null==(e=o.data)?void 0:e.code))throw new Error((null==(i=o.data)?void 0:i.msg)||"加载小区数据失败");{const e=o.data.data;this.visibleCells=(e.records||[]).map((e=>({id:e.id,blockNum:e.blockNum,blockName:e.blockName,remark:e.remark}))),this.totalCells=e.total||0}}catch(s){t("error","at pages/task-detail/task-detail.vue:666","加载小区数据失败:",s),this.loadError=!0,this.errorMessage=s.message||"网络请求失败",this.visibleCells=[]}finally{this.loadingCells=!1}},prevPage(){this.currentPage>1&&(this.currentPage--,this.loadCells())},nextPage(){this.currentPage<this.totalPages&&(this.currentPage++,this.loadCells())},selectCell(e){this.task.position=e.blockNum,this.plotDescription=e.blockName,uni.setStorageSync("blockId",e.id),t("log","at pages/task-detail/task-detail.vue:693","blockId",e.id),uni.setStorageSync("blockNum",e.blockNum),t("log","at pages/task-detail/task-detail.vue:695","blockNum",e.blockNum),this.showSwitchModal=!1,uni.showToast({title:`已切换到小区: ${e.blockNum}`,icon:"success"}),this.loadImages()},showDeleteConfirm(e,t){uni.vibrateShort(),this.deleteCellInfo=e,this.showDeleteDialog=!0},async confirmDeleteCell(){var e;if(!this.isDeleting)try{this.isDeleting=!0;const t=uni.getStorageSync("token"),i=await uni.request({url:`${this.baseUrl}/block/${this.deleteCellInfo.id}`,method:"POST",header:{Authorization:t,Accept:"*/*"}});let s=Array.isArray(i)?i[0]:i;if(200!==s.statusCode)throw new Error((null==(e=s.data)?void 0:e.msg)||"删除失败");uni.showToast({title:"删除成功",icon:"success"}),this.loadCells(),this.task.position===this.deleteCellInfo.blockNum&&(this.task.position="",this.plotDescription="")}catch(i){t("error","at pages/task-detail/task-detail.vue:747","删除小区失败:",i),uni.showToast({title:i.message||"删除失败",icon:"none"})}finally{this.isDeleting=!1,this.showDeleteDialog=!1}}}},[["render",function(t,i,s,n,o,a){return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"nav-bar"},[e.createElementVNode("view",{class:"nav-left",onClick:i[0]||(i[0]=(...e)=>a.goBack&&a.goBack(...e))},[e.createElementVNode("text",{class:"icon"},"←")]),e.createElementVNode("text",{class:"nav-title"},"任务详情"),e.createElementVNode("view",{class:"nav-right"},[e.createElementVNode("text",{class:"icon"},"⋮⋮")])]),e.createElementVNode("view",{class:"new-plot-btn-container"},[e.createElementVNode("button",{class:"new-plot-btn",onClick:i[1]||(i[1]=e=>o.showNewPlotModal=!0)},"新建小区"),e.createElementVNode("button",{class:"new-plot-btn switch-plot-btn",onClick:i[2]||(i[2]=(...e)=>a.openSwitchModal&&a.openSwitchModal(...e))},"切换小区")]),e.createElementVNode("view",{class:"info-card"},[e.createElementVNode("view",{class:"info-item"},[e.createElementVNode("text",{class:"info-label"},"任务ID："),e.createElementVNode("text",{class:"info-value"},e.toDisplayString(o.task.id),1)]),e.createElementVNode("view",{class:"info-item"},[e.createElementVNode("text",{class:"info-label"},"任务名称："),e.createElementVNode("text",{class:"info-value"},e.toDisplayString(o.task.taskName),1)]),e.createElementVNode("view",{class:"info-item"},[e.createElementVNode("text",{class:"info-label"},"小区编号："),e.createElementVNode("text",{class:"info-value"},e.toDisplayString(o.task.position),1)]),e.createElementVNode("view",{class:"info-item"},[e.createElementVNode("text",{class:"info-label"},"小区描述："),e.createElementVNode("text",{class:"info-value"},e.toDisplayString(o.plotDescription),1)])]),e.createElementVNode("view",{class:"image-list-container"},[e.createElementVNode("scroll-view",{class:"image-list","scroll-y":""},[0===a.filteredImages.length?(e.openBlock(),e.createElementBlock("view",{key:0,class:"empty-tip"},[e.createElementVNode("text",null,"暂无图片数据")])):e.createCommentVNode("",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.filteredImages,((t,i)=>(e.openBlock(),e.createElementBlock("view",{key:t.id,class:"image-item",onClick:e=>a.toggleSelect(t)},[e.createElementVNode("view",{class:"image-info-list"},[e.createElementVNode("view",{class:"image-status"},e.toDisplayString(a.getStatusText(t.status)),1),e.createElementVNode("view",{class:"image-id"},e.toDisplayString(t.imageNum||"未获取到编号"),1),t.selected?(e.openBlock(),e.createElementBlock("view",{key:0,class:"selected-mask-list"},[e.createElementVNode("view",{class:"selected-icon"},"✓")])):e.createCommentVNode("",!0)])],8,["onClick"])))),128))]),a.totalPages>1?(e.openBlock(),e.createElementBlock("view",{key:0,class:"pagination"},[e.createElementVNode("button",{class:"page-btn prev",onClick:i[3]||(i[3]=(...e)=>a.prevPage&&a.prevPage(...e)),disabled:1===o.currentPage},"上一页",8,["disabled"]),e.createElementVNode("text",{class:"page-info"},"第 "+e.toDisplayString(o.currentPage)+" 页 / 共 "+e.toDisplayString(a.totalPages)+" 页",1),e.createElementVNode("button",{class:"page-btn next",onClick:i[4]||(i[4]=(...e)=>a.nextPage&&a.nextPage(...e)),disabled:o.currentPage===a.totalPages},"下一页",8,["disabled"])])):e.createCommentVNode("",!0)]),e.createElementVNode("view",{class:"action-bar"},[e.createElementVNode("button",{class:"action-btn upload",onClick:i[5]||(i[5]=(...e)=>a.handleRefresh&&a.handleRefresh(...e))},"刷新"),e.createElementVNode("button",{class:"action-btn view",onClick:i[6]||(i[6]=(...e)=>a.handleView&&a.handleView(...e))},"查看"),e.createElementVNode("button",{class:"action-btn delete",onClick:i[7]||(i[7]=(...e)=>a.handleDelete&&a.handleDelete(...e))},"删除"),e.createElementVNode("button",{class:"action-btn capture",onClick:i[8]||(i[8]=(...e)=>a.goToCollect&&a.goToCollect(...e))},"采集")]),o.showNewPlotModal?(e.openBlock(),e.createElementBlock("view",{key:0,class:"modal"},[e.createElementVNode("view",{class:"modal-content new-plot-modal"},[e.createElementVNode("view",{class:"modal-header"},[e.createElementVNode("text",{class:"modal-title"},"新建小区")]),e.createElementVNode("view",{class:"modal-body"},[e.createElementVNode("view",{class:"form-group"},[e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("label",{class:"form-label"},"小区编号："),e.withDirectives(e.createElementVNode("input",{class:"form-input","onUpdate:modelValue":i[9]||(i[9]=e=>o.newPlotId=e),placeholder:"请输入小区编号"},null,512),[[e.vModelText,o.newPlotId]])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("label",{class:"form-label"},"小区描述："),e.withDirectives(e.createElementVNode("input",{class:"form-input","onUpdate:modelValue":i[10]||(i[10]=e=>o.newPlotDesc=e),placeholder:"请输入小区描述"},null,512),[[e.vModelText,o.newPlotDesc]])])])]),e.createElementVNode("view",{class:"modal-footer"},[e.createElementVNode("button",{class:"modal-btn cancel",onClick:i[11]||(i[11]=(...e)=>a.cancelNewPlot&&a.cancelNewPlot(...e))},"取消"),e.createElementVNode("button",{class:"modal-btn confirm",onClick:i[12]||(i[12]=(...e)=>a.confirmNewPlot&&a.confirmNewPlot(...e)),disabled:o.isSubmitting},[o.isSubmitting?(e.openBlock(),e.createElementBlock("text",{key:1},"提交中...")):(e.openBlock(),e.createElementBlock("text",{key:0},"确认"))],8,["disabled"])])])])):e.createCommentVNode("",!0),o.showUnuploadedWarning?(e.openBlock(),e.createElementBlock("view",{key:1,class:"modal"},[e.createElementVNode("view",{class:"modal-content warning"},[e.createElementVNode("view",{class:"modal-header"},[e.createElementVNode("text",{class:"modal-title"},"提示")]),e.createElementVNode("view",{class:"modal-body"},[e.createElementVNode("text",null,"当前存在未上传的图片，是否继续新建小区？")]),e.createElementVNode("view",{class:"modal-footer"},[e.createElementVNode("button",{class:"modal-btn cancel",onClick:i[13]||(i[13]=(...e)=>a.cancelNewPlot&&a.cancelNewPlot(...e))},"返回"),e.createElementVNode("button",{class:"modal-btn confirm",onClick:i[14]||(i[14]=(...e)=>a.forceNewPlot&&a.forceNewPlot(...e)),disabled:o.isSubmitting},[o.isSubmitting?(e.openBlock(),e.createElementBlock("text",{key:1},"提交中...")):(e.openBlock(),e.createElementBlock("text",{key:0},"确认"))],8,["disabled"])])])])):e.createCommentVNode("",!0),o.showSwitchModal?(e.openBlock(),e.createElementBlock("view",{key:2,class:"modal"},[e.createElementVNode("view",{class:"modal-content switch-modal"},[e.createElementVNode("view",{class:"modal-header"},[e.createElementVNode("text",{class:"modal-title"},"切换小区")]),e.createElementVNode("view",{class:"modal-body"},[o.loadingCells?(e.openBlock(),e.createElementBlock("view",{key:0,class:"loading-tip"},[e.createElementVNode("text",null,"小区数据加载中...")])):e.createCommentVNode("",!0),o.loadError?(e.openBlock(),e.createElementBlock("view",{key:1,class:"error-tip"},[e.createElementVNode("text",null,e.toDisplayString(o.errorMessage),1),e.createElementVNode("button",{class:"retry-btn",onClick:i[15]||(i[15]=(...e)=>a.loadCells&&a.loadCells(...e))},"重试")])):e.createCommentVNode("",!0),o.loadingCells||o.loadError?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("scroll-view",{key:2,"scroll-y":"",class:"cell-list",style:{height:"500rpx"}},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.visibleCells,((t,i)=>(e.openBlock(),e.createElementBlock("view",{key:t.id,class:"cell-item",onClick:e=>a.selectCell(t)},[e.createElementVNode("view",{class:"cell-info"},[e.createElementVNode("text",{class:"cell-id"},"小区编号："+e.toDisplayString(t.blockNum),1),e.createElementVNode("text",{class:"cell-desc"},"小区描述："+e.toDisplayString(t.blockName),1)]),e.createElementVNode("view",{class:"cell-actions"},[e.createElementVNode("view",{class:"cell-arrow"}),e.createElementVNode("button",{class:"delete-btn",onClick:e.withModifiers((e=>a.showDeleteConfirm(t,i)),["stop"])},"删除",8,["onClick"])])],8,["onClick"])))),128)),0===o.visibleCells.length?(e.openBlock(),e.createElementBlock("view",{key:0,class:"empty-tip"},[e.createElementVNode("text",null,"暂无小区数据")])):e.createCommentVNode("",!0)])),a.totalPages>1?(e.openBlock(),e.createElementBlock("view",{key:3,class:"pagination"},[e.createElementVNode("button",{class:"page-btn prev",onClick:i[16]||(i[16]=(...e)=>a.prevPage&&a.prevPage(...e)),disabled:1===o.currentPage},"上一页",8,["disabled"]),e.createElementVNode("text",{class:"page-info"},"第 "+e.toDisplayString(o.currentPage)+" 页 / 共 "+e.toDisplayString(a.totalPages)+" 页",1),e.createElementVNode("button",{class:"page-btn next",onClick:i[17]||(i[17]=(...e)=>a.nextPage&&a.nextPage(...e)),disabled:o.currentPage===a.totalPages},"下一页",8,["disabled"])])):e.createCommentVNode("",!0)]),e.createElementVNode("view",{class:"modal-footer"},[e.createElementVNode("button",{class:"modal-btn cancel",onClick:i[18]||(i[18]=e=>o.showSwitchModal=!1)},"取消")])])])):e.createCommentVNode("",!0),o.showDeleteDialog?(e.openBlock(),e.createElementBlock("view",{key:3,class:"modal"},[e.createElementVNode("view",{class:"modal-content delete-modal"},[e.createElementVNode("view",{class:"modal-header"},[e.createElementVNode("text",{class:"modal-title"},"删除确认")]),e.createElementVNode("view",{class:"modal-body"},[e.createElementVNode("text",null,"确定要删除小区 "+e.toDisplayString(o.deleteCellInfo.blockNum)+" 吗？",1)]),e.createElementVNode("view",{class:"modal-footer"},[e.createElementVNode("button",{class:"modal-btn cancel",onClick:i[19]||(i[19]=e=>o.showDeleteDialog=!1)},"取消"),e.createElementVNode("button",{class:"modal-btn confirm",onClick:i[20]||(i[20]=(...e)=>a.confirmDeleteCell&&a.confirmDeleteCell(...e)),disabled:o.isDeleting},[o.isDeleting?(e.openBlock(),e.createElementBlock("text",{key:1},"删除中...")):(e.openBlock(),e.createElementBlock("text",{key:0},"确认删除"))],8,["disabled"])])])])):e.createCommentVNode("",!0)])}],["__scopeId","data-v-c321373a"]]);const fe=ce({data:()=>({showCamera:!1,imageSrc:"",ossUrl:"",uploadStatus:"",taskId:"",locationStatus:"正在获取定位...",longitude:"114.1",latitude:"30.2",diseaseTypes:["黄叶病","锈斑病","其他"],diseaseIndex:0,diseaseLevel:"",imgId:"",sampleId:"",remark:"",uploadedImageUrls:[],blockNum:"",imageCounter:1,blockId:""}),onLoad(e){this.taskId=e.taskId||"",this.getLocation(),this.initImageId()},methods:{startCamera(){this.showCamera=!0,this.imageSrc="",this.ossUrl="",this.uploadStatus=""},takePhoto(){uni.createCameraContext().takePhoto({quality:"high",success:e=>{this.imageSrc=e.tempImagePath,this.showCamera=!1,this.getLocation()},fail:e=>{t("error","at pages/collect/collect.vue:152","拍照失败:",e),uni.showToast({title:"拍照失败，请重试",icon:"none"})}})},cancelCamera(){this.showCamera=!1,uni.navigateBack()},retakePhoto(){this.startCamera()},getLocation(){this.locationStatus="正在获取定位...",uni.getLocation({type:"wgs84",altitude:!0,success:e=>{this.longitude=e.longitude.toFixed(6),this.latitude=e.latitude.toFixed(6),this.locationStatus="定位成功"},fail:e=>{t("error","at pages/collect/collect.vue:178","获取定位失败:",e),this.locationStatus="定位失败",this.longitude="114.353280",this.latitude="30.477193",this.remark="无"}})},onDiseaseChange(e){const i=e.detail.value;i>=0&&i<this.diseaseTypes.length?this.diseaseIndex=i:(t("warn","at pages/collect/collect.vue:192","无效的病害类型选择:",i),this.diseaseIndex=0)},chooseFromAlbum(){uni.chooseImage({count:1,success:e=>{this.imageSrc=e.tempFilePaths[0],this.initImageId(),this.getLocation()}})},initImageId(){if(this.blockId=uni.getStorageSync("blockId")||"",this.blockNum=uni.getStorageSync("blockNum")||"unknown",!this.blockNum||"unknown"===this.blockNum)return void(this.imgId="unknown_001");const e=`imageCounter_${this.blockNum}`;this.imageCounter=uni.getStorageSync(e)||1,this.imgId=`${this.blockNum}_${this.imageCounter.toString().padStart(3,"0")}`},async confirmImage(){var e;if(this.validateForm())try{uni.showLoading({title:"上传数据中...",mask:!0});const n=uni.getStorageSync("token")||"";t("log","at pages/collect/collect.vue:235","【调试】token:",n);const o=uni.getStorageSync("branchTaskId");t("log","at pages/collect/collect.vue:238","【调试】branchTaskId:",o),this.blockId=uni.getStorageSync("blockId")||"",t("log","at pages/collect/collect.vue:242","【调试】blockId:",this.blockId);t("log","at pages/collect/collect.vue:245","【调试】blockName:",uni.getStorageSync("blockName"));const a=`${this.sampleId||""}#${this.remark||""}`,r=await uni.uploadFile({url:"https://larsc.hzau.edu.cn/prod-api/plant-disease/uploadPic",filePath:this.imageSrc,name:"file",header:{Authorization:n}});if(t("log","at pages/collect/collect.vue:259","【调试】uploadPicRes原始响应:",r),200!==r.statusCode)throw new Error(`上传图片失败，状态码: ${r.statusCode}`);try{let s={};try{s=JSON.parse(r.data)}catch(i){s={url:r.data},t("log","at pages/collect/collect.vue:274","【调试】使用纯文本解析响应:",s)}t("log","at pages/collect/collect.vue:277","【调试】uploadPicData解析后:",s);const l=(null==(e=s.data)?void 0:e.url)||s.url||(null==s?void 0:s.data)||r.data;if(!l)throw new Error("未获取到图片URL");t("log","at pages/collect/collect.vue:290","【调试】imageUrl:",l),this.ossUrl=l;const c=await uni.request({url:"https://larsc.hzau.edu.cn/prod-api/plant-disease/uploadInfo",method:"POST",header:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},data:{imageUrl:l,imageNum:this.imgId,longitude:this.longitude,latitude:this.latitude,branchTaskId:o,blockId:this.blockId,blockNum:this.blockNum,diseaseType:this.diseaseTypes[this.diseaseIndex],diseaseLevel:this.diseaseLevel,remark:a}});if(t("log","at pages/collect/collect.vue:314","【调试】uploadInfoRes响应:",c),uni.hideLoading(),200!==c.statusCode||200!==c.data.code)throw new Error(c.data.msg||"上传图片信息失败");{uni.showToast({title:"上传成功",icon:"success"});const e=`imageCounter_${this.blockNum}`;this.imageCounter++,uni.setStorageSync(e,this.imageCounter),this.imgId=`${this.blockNum}_${this.imageCounter.toString().padStart(3,"0")}`,setTimeout((()=>{uni.navigateBack()}),1500)}}catch(s){throw t("error","at pages/collect/collect.vue:336","【错误】解析图片响应失败:",s),new Error("解析图片响应失败")}}catch(n){uni.hideLoading();const e=n.message||"上传失败";uni.showToast({title:`上传失败: ${e}`,icon:"none",duration:3e3}),t("error","at pages/collect/collect.vue:347","【错误】上传流程异常:",n)}},validateForm(){return this.imageSrc?this.imgId?void 0===this.diseaseIndex||this.diseaseIndex<0||this.diseaseIndex>=this.diseaseTypes.length?(uni.showToast({title:"请选择有效的病害类型",icon:"none"}),!1):!(!this.diseaseLevel||isNaN(parseInt(this.diseaseLevel))||parseInt(this.diseaseLevel)<1||parseInt(this.diseaseLevel)>9)||(uni.showToast({title:"请输入有效的病害等级(1-9)",icon:"none"}),!1):(uni.showToast({title:"图片编号生成失败",icon:"none"}),!1):(uni.showToast({title:"请先拍摄或选择图片",icon:"none"}),!1)}},onUnload(){}},[["render",function(t,i,s,n,o,a){return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"header"},[e.createElementVNode("text",{class:"title"},"玉米叶片采集"),e.createElementVNode("view",{class:"connection-status"},[e.createElementVNode("text",null,e.toDisplayString(o.locationStatus),1)])]),o.showCamera?(e.openBlock(),e.createElementBlock("view",{key:0,class:"camera-container"},[e.createElementVNode("camera",{class:"camera","device-position":"back",flash:"off",style:{height:"70vh"}}),e.createElementVNode("view",{class:"grid-overlay"},[e.createElementVNode("view",{class:"grid-line vertical-line-1"}),e.createElementVNode("view",{class:"grid-line vertical-line-2"}),e.createElementVNode("view",{class:"grid-line horizontal-line-1"}),e.createElementVNode("view",{class:"grid-line horizontal-line-2"})])])):e.createCommentVNode("",!0),!o.showCamera&&o.imageSrc?(e.openBlock(),e.createElementBlock("view",{key:1,class:"preview-container"},[e.createElementVNode("image",{src:o.imageSrc,class:"preview-image",mode:"aspectFill"},null,8,["src"]),o.ossUrl?(e.openBlock(),e.createElementBlock("view",{key:0,class:"oss-url"},[e.createElementVNode("text",null,"OSS URL: "+e.toDisplayString(o.ossUrl),1)])):e.createCommentVNode("",!0),o.uploadStatus?(e.openBlock(),e.createElementBlock("view",{key:1,class:"upload-status"},[e.createElementVNode("text",null,e.toDisplayString(o.uploadStatus),1)])):e.createCommentVNode("",!0)])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"button-area"},[o.showCamera?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("button",{class:"action-btn capture",onClick:i[0]||(i[0]=(...e)=>a.takePhoto&&a.takePhoto(...e))},"拍照"),e.createElementVNode("button",{class:"action-btn cancel",onClick:i[1]||(i[1]=(...e)=>a.cancelCamera&&a.cancelCamera(...e))},"返回")],64)):e.createCommentVNode("",!0),!o.showCamera&&o.imageSrc?(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[e.createElementVNode("view",{class:"form-container"},[e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"经度："),e.withDirectives(e.createElementVNode("input",{class:"input","onUpdate:modelValue":i[2]||(i[2]=e=>o.longitude=e),placeholder:"请输入经度",readonly:""},null,512),[[e.vModelText,o.longitude]])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"纬度："),e.withDirectives(e.createElementVNode("input",{class:"input","onUpdate:modelValue":i[3]||(i[3]=e=>o.latitude=e),placeholder:"请输入纬度",readonly:""},null,512),[[e.vModelText,o.latitude]])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"图片编号："),e.withDirectives(e.createElementVNode("input",{class:"input","onUpdate:modelValue":i[4]||(i[4]=e=>o.imgId=e),placeholder:"自动生成",readonly:""},null,512),[[e.vModelText,o.imgId]])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"样品编号："),e.withDirectives(e.createElementVNode("input",{class:"input","onUpdate:modelValue":i[5]||(i[5]=e=>o.sampleId=e),placeholder:"请输入样品编号"},null,512),[[e.vModelText,o.sampleId]])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"病害类型："),e.createElementVNode("picker",{class:"picker",mode:"selector",range:o.diseaseTypes,onChange:i[6]||(i[6]=(...e)=>a.onDiseaseChange&&a.onDiseaseChange(...e))},[e.createElementVNode("view",{class:"picker-text"},e.toDisplayString(o.diseaseTypes[o.diseaseIndex]||"请选择病害类型"),1)],40,["range"])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"病害等级："),e.withDirectives(e.createElementVNode("input",{class:"input","onUpdate:modelValue":i[7]||(i[7]=e=>o.diseaseLevel=e),placeholder:"请输入病害等级(1-9)",type:"number",max:"9",min:"1"},null,512),[[e.vModelText,o.diseaseLevel]])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"备注："),e.withDirectives(e.createElementVNode("input",{class:"input","onUpdate:modelValue":i[8]||(i[8]=e=>o.remark=e),placeholder:"请输入备注信息"},null,512),[[e.vModelText,o.remark]])])]),e.createElementVNode("button",{class:"action-btn confirm",onClick:i[9]||(i[9]=(...e)=>a.confirmImage&&a.confirmImage(...e))},"确认上传"),e.createElementVNode("button",{class:"action-btn retake",onClick:i[10]||(i[10]=(...e)=>a.retakePhoto&&a.retakePhoto(...e))},"重新拍摄")],64)):e.createCommentVNode("",!0),o.showCamera||o.imageSrc?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock(e.Fragment,{key:2},[e.createElementVNode("button",{class:"action-btn capture",onClick:i[11]||(i[11]=(...e)=>a.startCamera&&a.startCamera(...e))},"调用相机拍摄"),e.createElementVNode("button",{class:"action-btn album",onClick:i[12]||(i[12]=(...e)=>a.chooseFromAlbum&&a.chooseFromAlbum(...e))},"从图库上传")],64))])])}],["__scopeId","data-v-0a5d4fab"]]);const ve=ce({data:()=>({taskId:"",taskName:"",plotId:"",blockNum:"",imgId:"",imageUrl:"",longitude:"",latitude:"",sampleId:"",remark:"",diseaseType:"",diseaseLevel:"",status:"",isEditing:!1,editLongitude:"",editLatitude:"",editSampleId:"",editRemark:"",editDiseaseLevel:"",diseaseTypes:["黄叶病","锈斑病","其他"],diseaseIndex:0,imageDetail:null,globalData:getApp().globalData,showModifyModal:!1,showPreview:!1,isSubmitting:!1,originalNote:""}),computed:{formattedImageUrl(){return this.imageUrl?this.imageUrl.replace("localhost","larsc.hzau.edu.cn"):""}},onLoad(e){this.taskId=e.taskId||"",this.taskName=e.taskName||"",this.plotId=e.plotId||"",this.imgId=e.imgId||"",this.branchTaskId=e.branchTaskId||"",this.blockId=e.blockId||"",this.imageNum=e.imageNum||"",this.fetchImageDetail()},methods:{async fetchImageDetail(){var e,i;if(this.branchTaskId&&this.blockId&&this.imageNum)try{uni.showLoading({title:"加载中..."});const t=uni.getStorageSync("token");if(!t)throw new Error("用户未登录");const s=await uni.request({url:`${this.globalData.baseUrl||"https://larsc.hzau.edu.cn/prod-api"}/plant-disease/singlePictureInfo`,method:"GET",header:{Authorization:t,Accept:"*/*"},data:{branchTaskId:this.branchTaskId,blockId:this.blockId,imageNum:this.imageNum}});let n=Array.isArray(s)?s[0]:s;if(200!==n.statusCode||200!==(null==(e=n.data)?void 0:e.code))throw new Error((null==(i=n.data)?void 0:i.msg)||"获取图片信息失败");{const e=n.data.data;if(this.imageDetail=e,this.imageUrl=e.imageUrl,this.longitude=e.longitude,this.latitude=e.latitude,this.originalNote=e.remark||"",this.originalNote){const e=this.originalNote.split("#");this.sampleId=e[0]||"",this.remark=e[1]||""}this.diseaseType=e.diseaseType,this.diseaseLevel=e.diseaseLevel,this.status=e.status||"uploaded",this.blockNum=e.blockNum,this.imgId=e.imageNum||this.imgId,this.editLongitude=this.longitude,this.editLatitude=this.latitude,this.editSampleId=this.sampleId,this.editRemark=this.remark,this.editDiseaseLevel=this.diseaseLevel,this.diseaseIndex=this.diseaseTypes.indexOf(this.diseaseType)>=0?this.diseaseTypes.indexOf(this.diseaseType):0}}catch(s){t("error","at pages/result/result.vue:286","获取图片详情失败:",s),uni.showToast({title:s.message||"获取图片信息失败",icon:"none"})}finally{uni.hideLoading()}else uni.showToast({title:"参数不完整，无法获取图片信息",icon:"none"})},startEditing(){this.isEditing=!0},confirmEditing(){this.showModifyModal=!0},cancelModify(){this.showModifyModal=!1},async saveModify(){var e,i,s;if(!this.isSubmitting)if(this.editDiseaseLevel&&(this.editDiseaseLevel<1||this.editDiseaseLevel>9))uni.showToast({title:"病害等级必须在1-9之间",icon:"none"});else try{this.isSubmitting=!0,this.showModifyModal=!1;const t=uni.getStorageSync("token");if(!t)throw new Error("用户未登录");const n=`${this.editSampleId||""}#${this.editRemark||""}`,o={id:null==(e=this.imageDetail)?void 0:e.id,longitude:this.editLongitude,latitude:this.editLatitude,remark:n,diseaseType:this.diseaseTypes[this.diseaseIndex],diseaseLevel:this.editDiseaseLevel,imageUrl:this.imageUrl,branchTaskId:this.branchTaskId,blockId:this.blockId,blockNum:this.blockNum},a=await uni.request({url:`${this.globalData.baseUrl||"https://larsc.hzau.edu.cn/prod-api"}/plant-disease/editInfo`,method:"POST",header:{Authorization:t,"Content-Type":"application/json",Accept:"*/*"},data:o});let r=Array.isArray(a)?a[0]:a;if(200!==r.statusCode||200!==(null==(i=r.data)?void 0:i.code))throw new Error((null==(s=r.data)?void 0:s.msg)||"修改失败");this.longitude=this.editLongitude,this.latitude=this.editLatitude,this.sampleId=this.editSampleId,this.remark=this.editRemark,this.diseaseLevel=this.editDiseaseLevel,this.diseaseType=this.diseaseTypes[this.diseaseIndex],this.originalNote=n,this.isEditing=!1,uni.showToast({title:"修改成功",icon:"success"}),uni.$emit("imageInfoUpdated",{imgId:this.imgId,updatedData:{longitude:this.longitude,latitude:this.latitude,remark:n,diseaseType:this.diseaseType,diseaseLevel:this.diseaseLevel}}),setTimeout((()=>{uni.navigateBack()}),500)}catch(n){t("error","at pages/result/result.vue:401","修改图片信息失败:",n),uni.showToast({title:n.message||"修改失败",icon:"none"})}finally{this.isSubmitting=!1}},onDiseaseChange(e){this.diseaseIndex=e.detail.value},validateDiseaseLevel(e){let t=e.detail.value;t&&(t=parseInt(t),isNaN(t)||t<1?t=1:t>9&&(t=9),this.editDiseaseLevel=t.toString())},getStatusText:e=>({uploaded:"已上传",notUploaded:"未上传"}[e]||e),showImagePreview(){this.imageUrl&&(this.showPreview=!0)},closePreview(){this.showPreview=!1},handleBack(){this.isEditing?uni.showModal({title:"提示",content:"您有未保存的修改，确定要返回吗？",success:e=>{e.confirm&&(this.editSampleId=this.sampleId,this.editRemark=this.remark,this.isEditing=!1,uni.navigateBack())}}):uni.navigateBack()}}},[["render",function(t,i,s,n,o,a){return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"result-content"},[e.createElementVNode("view",{class:"image-single"},[o.imageUrl?(e.openBlock(),e.createElementBlock("image",{key:0,class:"result-image",src:a.formattedImageUrl,mode:"aspectFill",onClick:i[0]||(i[0]=(...e)=>a.showImagePreview&&a.showImagePreview(...e))},null,8,["src"])):(e.openBlock(),e.createElementBlock("view",{key:1,class:"loading-tip"},[e.createElementVNode("text",null,"加载图片中...")]))]),e.createElementVNode("view",{class:"info-group"},[e.createElementVNode("view",{class:"info-item"},[e.createElementVNode("text",{class:"info-label"},"任务ID："),e.createElementVNode("text",{class:"info-value"},e.toDisplayString(o.taskId),1)]),e.createElementVNode("view",{class:"info-item"},[e.createElementVNode("text",{class:"info-label"},"任务名称："),e.createElementVNode("text",{class:"info-value"},e.toDisplayString(o.taskName),1)]),e.createElementVNode("view",{class:"info-item"},[e.createElementVNode("text",{class:"info-label"},"小区ID："),e.createElementVNode("text",{class:"info-value"},e.toDisplayString(o.plotId),1)]),e.createElementVNode("view",{class:"info-item"},[e.createElementVNode("text",{class:"info-label"},"小区名称："),e.createElementVNode("text",{class:"info-value"},e.toDisplayString(o.blockNum),1)]),e.createElementVNode("view",{class:"info-item"},[e.createElementVNode("text",{class:"info-label"},"图片编号："),e.createElementVNode("view",{class:"info-value"},e.toDisplayString(o.imgId),1)]),o.isEditing?(e.openBlock(),e.createElementBlock("view",{key:1,class:"info-item"},[e.createElementVNode("text",{class:"info-label"},"样品编号："),e.withDirectives(e.createElementVNode("input",{class:"edit-input","onUpdate:modelValue":i[1]||(i[1]=e=>o.editSampleId=e),placeholder:"请输入样品编号"},null,512),[[e.vModelText,o.editSampleId]])])):(e.openBlock(),e.createElementBlock("view",{key:0,class:"info-item"},[e.createElementVNode("text",{class:"info-label"},"样品编号："),e.createElementVNode("text",{class:"info-value"},e.toDisplayString(o.sampleId),1)])),o.isEditing?(e.openBlock(),e.createElementBlock("view",{key:3,class:"info-item"},[e.createElementVNode("text",{class:"info-label"},"经度："),e.withDirectives(e.createElementVNode("input",{class:"edit-input","onUpdate:modelValue":i[2]||(i[2]=e=>o.editLongitude=e),placeholder:"请输入经度"},null,512),[[e.vModelText,o.editLongitude]])])):(e.openBlock(),e.createElementBlock("view",{key:2,class:"info-item"},[e.createElementVNode("text",{class:"info-label"},"经度："),e.createElementVNode("text",{class:"info-value"},e.toDisplayString(o.longitude),1)])),o.isEditing?(e.openBlock(),e.createElementBlock("view",{key:5,class:"info-item"},[e.createElementVNode("text",{class:"info-label"},"纬度："),e.withDirectives(e.createElementVNode("input",{class:"edit-input","onUpdate:modelValue":i[3]||(i[3]=e=>o.editLatitude=e),placeholder:"请输入纬度"},null,512),[[e.vModelText,o.editLatitude]])])):(e.openBlock(),e.createElementBlock("view",{key:4,class:"info-item"},[e.createElementVNode("text",{class:"info-label"},"纬度："),e.createElementVNode("text",{class:"info-value"},e.toDisplayString(o.latitude),1)])),o.isEditing?(e.openBlock(),e.createElementBlock("view",{key:7,class:"info-item"},[e.createElementVNode("text",{class:"info-label"},"备注："),e.withDirectives(e.createElementVNode("input",{class:"edit-input","onUpdate:modelValue":i[4]||(i[4]=e=>o.editRemark=e),placeholder:"请输入备注信息"},null,512),[[e.vModelText,o.editRemark]])])):(e.openBlock(),e.createElementBlock("view",{key:6,class:"info-item"},[e.createElementVNode("text",{class:"info-label"},"备注："),e.createElementVNode("text",{class:"info-value"},e.toDisplayString(o.remark),1)])),o.isEditing?(e.openBlock(),e.createElementBlock("view",{key:9,class:"info-item"},[e.createElementVNode("text",{class:"info-label"},"病害类型："),e.createElementVNode("picker",{class:"picker",mode:"selector",range:o.diseaseTypes,onChange:i[5]||(i[5]=(...e)=>a.onDiseaseChange&&a.onDiseaseChange(...e)),value:o.diseaseIndex},[e.createElementVNode("view",{class:"picker-text"},e.toDisplayString(o.diseaseTypes[o.diseaseIndex]||"请选择病害类型"),1)],40,["range","value"])])):(e.openBlock(),e.createElementBlock("view",{key:8,class:"info-item"},[e.createElementVNode("text",{class:"info-label"},"病害类型："),e.createElementVNode("text",{class:"info-value"},e.toDisplayString(o.diseaseType),1)])),o.isEditing?(e.openBlock(),e.createElementBlock("view",{key:11,class:"info-item"},[e.createElementVNode("text",{class:"info-label"},"病害等级："),e.withDirectives(e.createElementVNode("input",{class:"edit-input","onUpdate:modelValue":i[6]||(i[6]=e=>o.editDiseaseLevel=e),placeholder:"请输入病害等级(1-9)",type:"digit",onInput:i[7]||(i[7]=(...e)=>a.validateDiseaseLevel&&a.validateDiseaseLevel(...e))},null,544),[[e.vModelText,o.editDiseaseLevel]])])):(e.openBlock(),e.createElementBlock("view",{key:10,class:"info-item"},[e.createElementVNode("text",{class:"info-label"},"病害等级："),e.createElementVNode("text",{class:"info-value"},e.toDisplayString(o.diseaseLevel),1)])),e.createElementVNode("view",{class:"info-item"},[e.createElementVNode("text",{class:"info-label"},"上传状态："),e.createElementVNode("text",{class:"info-value"},e.toDisplayString(a.getStatusText(o.status)),1)])])]),e.createElementVNode("view",{class:"button-area"},[o.isEditing?(e.openBlock(),e.createElementBlock("button",{key:1,class:"action-btn confirm-modify",onClick:i[9]||(i[9]=(...e)=>a.confirmEditing&&a.confirmEditing(...e))},"确认修改")):(e.openBlock(),e.createElementBlock("button",{key:0,class:"action-btn modify",onClick:i[8]||(i[8]=(...e)=>a.startEditing&&a.startEditing(...e))},"修改")),e.createElementVNode("button",{class:"action-btn back",onClick:i[10]||(i[10]=(...e)=>a.handleBack&&a.handleBack(...e))},"返回")]),o.showModifyModal?(e.openBlock(),e.createElementBlock("view",{key:0,class:"modal"},[e.createElementVNode("view",{class:"modal-content"},[e.createElementVNode("view",{class:"modal-header"},[e.createElementVNode("text",{class:"modal-title"},"确认修改")]),e.createElementVNode("view",{class:"modal-body"},[e.createElementVNode("text",null,"是否对编号为 "+e.toDisplayString(o.imgId)+" 的图片进行信息修改？",1)]),e.createElementVNode("view",{class:"modal-footer"},[e.createElementVNode("button",{class:"modal-btn cancel",onClick:i[11]||(i[11]=(...e)=>a.cancelModify&&a.cancelModify(...e))},"返回"),e.createElementVNode("button",{class:"modal-btn confirm",onClick:i[12]||(i[12]=(...e)=>a.saveModify&&a.saveModify(...e))},"确认")])])])):e.createCommentVNode("",!0),o.showPreview?(e.openBlock(),e.createElementBlock("view",{key:1,class:"image-preview"},[e.createElementVNode("view",{class:"preview-mask",onClick:i[13]||(i[13]=(...e)=>a.closePreview&&a.closePreview(...e))}),e.createElementVNode("view",{class:"preview-content"},[e.createElementVNode("image",{class:"preview-image",src:a.formattedImageUrl,mode:"aspectFit"},null,8,["src"]),e.createElementVNode("view",{class:"close-btn",onClick:i[14]||(i[14]=(...e)=>a.closePreview&&a.closePreview(...e))},"×")])])):e.createCommentVNode("",!0)])}],["__scopeId","data-v-fafbb327"]]);const ye=ce({data:()=>({isOnline:!0,imageSrc:"",longitude:"",latitude:"",diseaseTypes:["黄叶病","锈斑病","其他"],diseaseIndex:0,diseaseLevel:"",remark:"",taskName:"",plotName:""}),onShow(){this.checkNetwork(),this.getLocation()},onLoad(){this.requestAndroidPermissions()},methods:{requestAndroidPermissions(){if("undefined"!=typeof plus&&"Android"===plus.os.name){const e=["android.permission.READ_EXTERNAL_STORAGE","android.permission.WRITE_EXTERNAL_STORAGE"];plus.android.requestPermissions(e,(i=>{const s=i.granted;i.deniedPresent,i.deniedAlways,t("log","at pages/offline/offline.vue:124","权限申请结果：",i),s.length===e.length?t("log","at pages/offline/offline.vue:127","所有权限已授予"):uni.showModal({title:"权限提醒",content:"为了正常使用，请授予存储权限",showCancel:!1})}),(e=>{t("error","at pages/offline/offline.vue:136","权限申请失败：",e)}))}},checkNetwork(){uni.getNetworkType({success:e=>{this.isOnline="none"!==e.networkType}})},getLocation(){uni.getLocation({type:"wgs84",success:e=>{this.longitude=e.longitude.toFixed(6),this.latitude=e.latitude.toFixed(6)},fail:()=>{this.longitude="",this.latitude=""}})},takePhoto(){uni.chooseImage({count:1,sourceType:["camera"],success:e=>{this.imageSrc=e.tempFilePaths[0],this.getLocation()},fail:()=>{uni.showToast({title:"拍照失败",icon:"none"})}})},chooseFromAlbum(){uni.chooseImage({count:1,success:e=>{this.imageSrc=e.tempFilePaths[0],this.getLocation()}})},onDiseaseChange(e){this.diseaseIndex=e.detail.value},async saveOfflineData(){if(!(this.taskName&&this.plotName&&this.imageSrc&&this.diseaseLevel))return void uni.showToast({title:"请填写完整信息",icon:"none"});const e="undefined"!=typeof plus,i={id:Date.now(),taskName:this.taskName,plotName:this.plotName,image:this.imageSrc,longitude:this.longitude,latitude:this.latitude,diseaseType:this.diseaseTypes[this.diseaseIndex],diseaseLevel:this.diseaseLevel,remark:this.remark,timestamp:(new Date).toISOString()};if(e){if("Android"===plus.os.name){if(!(await new Promise(((e,t)=>{if("android"!==plus.os.name.toLowerCase())return void e(!0);const i=plus.android.runtimeMainActivity(),s="android.permission.WRITE_EXTERNAL_STORAGE",n=plus.android.importClass("android.content.pm.PackageManager");i.getPackageManager().checkPermission(s,i.getPackageName())===n.PERMISSION_GRANTED?e(!0):(plus.android.importClass("android.support.v4.app.ActivityCompat").requestPermissions(i,[s],0),setTimeout((()=>{e(!0)}),1e3))}))))return void uni.showToast({title:"请授予存储权限",icon:"none"})}i.taskName;i.plotName;const e=i.id,s=`${e}.json`,n=plus.io.convertLocalFileSystemURL(i.image);plus.io.resolveLocalFileSystemURL(n,(n=>{plus.io.requestFileSystem(plus.io.PRIVATE_DOC,(o=>{o.root.getDirectory("offline",{create:!0},(o=>{o.getDirectory(i.taskName,{create:!0},(o=>{o.getDirectory(i.plotName,{create:!0},(o=>{const a=i.image.substring(i.image.lastIndexOf(".")),r=`${e}${a}`;n.copyTo(o,r,(e=>{i.image=e.fullPath.startsWith("file://")?e.fullPath:"file://"+e.fullPath,o.getFile(s,{create:!0},(e=>{e.createWriter((e=>{e.write(JSON.stringify(i,null,2)),uni.showToast({title:"保存成功",icon:"success"}),this.resetForm()}),(e=>{t("error","at pages/offline/offline.vue:378","写入JSON文件失败:",e),uni.showToast({title:"保存失败",icon:"none"})}))}),(e=>{t("error","at pages/offline/offline.vue:382","创建JSON文件失败:",e),uni.showToast({title:"保存失败",icon:"none"})}))}),(e=>{t("error","at pages/offline/offline.vue:386","复制图片失败:",e),uni.showToast({title:"保存失败",icon:"none"})}))}),(e=>{t("error","at pages/offline/offline.vue:391","创建小区文件夹失败:",e),uni.showToast({title:"保存失败",icon:"none"})}))}),(e=>{t("error","at pages/offline/offline.vue:395","创建任务文件夹失败:",e),uni.showToast({title:"保存失败",icon:"none"})}))}),(e=>{t("error","at pages/offline/offline.vue:399","创建offline文件夹失败:",e),uni.showToast({title:"保存失败",icon:"none"})}))}),(e=>{t("error","at pages/offline/offline.vue:403","请求文件系统失败:",e),uni.showToast({title:"保存失败",icon:"none"})}))}),(e=>{t("error","at pages/offline/offline.vue:407","读取图片路径失败:",e),uni.showToast({title:"保存失败",icon:"none"})}))}else try{const e=await fetch(i.image),t=await e.blob(),s=await new Promise(((e,i)=>{const s=new FileReader;s.onloadend=()=>e(s.result),s.onerror=i,s.readAsDataURL(t)}));i.image=s;const n=`taskData_${i.taskName}_${i.plotName}`,o=uni.getStorageSync(n)||[];o.push(i),uni.setStorageSync(n,o),uni.showToast({title:"本地保存成功",icon:"success"}),this.resetForm()}catch(s){t("error","at pages/offline/offline.vue:434","H5图片转换失败:",s),uni.showToast({title:"图片处理失败",icon:"none"})}},resetForm(){this.imageSrc="",this.taskName="",this.plotName="",this.longitude="",this.latitude="",this.diseaseIndex=0,this.diseaseLevel="",this.remark=""},goBack(){uni.reLaunch({url:"/pages/login/login"})},goToRecordView(){uni.navigateTo({url:"/pages/record/record"})},resetForm(){this.imageSrc="",this.diseaseLevel="",this.remark="",this.taskName="",this.plotName=""}}},[["render",function(t,i,s,n,o,a){return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"header"},[e.createElementVNode("text",{class:"title"},"离线采集"),e.createElementVNode("text",{class:"status"},e.toDisplayString(o.isOnline?"已联网":"离线模式"),1)]),o.imageSrc?(e.openBlock(),e.createElementBlock("view",{key:0,class:"preview-area"},[e.createElementVNode("image",{src:o.imageSrc,class:"preview-img",mode:"aspectFill"},null,8,["src"])])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"form-container"},[e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"任务名："),e.withDirectives(e.createElementVNode("input",{class:"input","onUpdate:modelValue":i[0]||(i[0]=e=>o.taskName=e),placeholder:"请输入任务名"},null,512),[[e.vModelText,o.taskName]])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"小区名："),e.withDirectives(e.createElementVNode("input",{class:"input","onUpdate:modelValue":i[1]||(i[1]=e=>o.plotName=e),placeholder:"请输入小区名"},null,512),[[e.vModelText,o.plotName]])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"经度："),e.withDirectives(e.createElementVNode("input",{class:"input","onUpdate:modelValue":i[2]||(i[2]=e=>o.longitude=e),placeholder:"自动获取",readonly:""},null,512),[[e.vModelText,o.longitude]])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"纬度："),e.withDirectives(e.createElementVNode("input",{class:"input","onUpdate:modelValue":i[3]||(i[3]=e=>o.latitude=e),placeholder:"自动获取",readonly:""},null,512),[[e.vModelText,o.latitude]])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"病害类型："),e.createElementVNode("picker",{range:o.diseaseTypes,onChange:i[4]||(i[4]=(...e)=>a.onDiseaseChange&&a.onDiseaseChange(...e))},[e.createElementVNode("view",{class:"picker-text"},e.toDisplayString(o.diseaseTypes[o.diseaseIndex]||"请选择病害类型"),1)],40,["range"])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"等级："),e.withDirectives(e.createElementVNode("input",{class:"input",type:"number","onUpdate:modelValue":i[5]||(i[5]=e=>o.diseaseLevel=e),placeholder:"1-9"},null,512),[[e.vModelText,o.diseaseLevel]])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"备注："),e.withDirectives(e.createElementVNode("input",{class:"input","onUpdate:modelValue":i[6]||(i[6]=e=>o.remark=e),placeholder:"请输入备注"},null,512),[[e.vModelText,o.remark]])])]),e.createElementVNode("view",{class:"button-area"},[e.createElementVNode("button",{onClick:i[7]||(i[7]=(...e)=>a.takePhoto&&a.takePhoto(...e)),class:"btn camera"},"拍照"),e.createElementVNode("button",{onClick:i[8]||(i[8]=(...e)=>a.chooseFromAlbum&&a.chooseFromAlbum(...e)),class:"btn album"},"选择图片"),e.createElementVNode("button",{onClick:i[9]||(i[9]=(...e)=>a.saveOfflineData&&a.saveOfflineData(...e)),class:"btn save"},"保存本地"),e.createElementVNode("button",{onClick:i[10]||(i[10]=(...e)=>a.goBack&&a.goBack(...e)),class:"btn goback"},"返回登录"),e.createElementVNode("button",{onClick:i[11]||(i[11]=(...e)=>a.goToRecordView&&a.goToRecordView(...e)),class:"btn record"},"查看记录")])])}],["__scopeId","data-v-f04509cf"]]);const we=ce({data:()=>({records:[]}),onShow(){this.loadRecords()},methods:{async loadRecords(){if("undefined"!=typeof plus){this.records=[];try{await this.requestStoragePermission();const i=await this.getOrCreateDir("_doc/offline"),s=await this.readDirEntries(i);for(const n of s){const s=await this.getDirEntry(i,n),o=await this.readDirEntries(s),a=[];for(const i of o){const n=await this.getDirEntry(s,i),o=await this.readDirEntries(n),r=[];for(const i of o)if(i.endsWith(".json")){const s=await this.getFileEntry(n,i),o=await this.readFileContent(s);try{const e=JSON.parse(o);r.push(e)}catch(e){t("warn","at pages/record/record.vue:77","解析 JSON 失败:",e)}}a.push({plotName:i,items:r})}this.records.push({taskName:n,plots:a})}}catch(i){t("error","at pages/record/record.vue:94",i),uni.showToast({title:"加载记录失败",icon:"none"})}}else uni.showToast({title:"非App环境暂不支持查看离线记录",icon:"none"})},requestStoragePermission:()=>new Promise(((e,t)=>{if("android"!==plus.os.name.toLowerCase())return void e(!0);const i=plus.android.runtimeMainActivity(),s="android.permission.WRITE_EXTERNAL_STORAGE",n=plus.android.importClass("android.content.pm.PackageManager");if(i.getPackageManager().checkPermission(s,i.getPackageName())===n.PERMISSION_GRANTED)e(!0);else{plus.android.importClass("android.support.v4.app.ActivityCompat").requestPermissions(i,[s],0),setTimeout((()=>e(!0)),1e3)}})),getOrCreateDir:e=>new Promise(((t,i)=>{plus.io.resolveLocalFileSystemURL(e,(e=>{t(e)}),(()=>{plus.io.requestFileSystem(plus.io.PRIVATE_DOC,(s=>{s.root.getDirectory(e.replace("_doc/",""),{create:!0},(e=>{t(e)}),i)}),i)}))})),readDirEntries:e=>new Promise(((t,i)=>{e.createReader().readEntries((e=>{const i=e.map((e=>e.name));t(i)}),i)})),getDirEntry:(e,t)=>new Promise(((i,s)=>{e.getDirectory(t,{},i,s)})),getFileEntry:(e,t)=>new Promise(((i,s)=>{e.getFile(t,{},i,s)})),readFileContent:e=>new Promise(((t,i)=>{e.file((e=>{const s=new plus.io.FileReader;s.onloadend=()=>t(s.result),s.onerror=i,s.readAsText(e)}))})),removeFile:e=>new Promise(((t,i)=>{let s=e.startsWith("file://")?e:"file://"+e;plus.io.resolveLocalFileSystemURL(s,(e=>{e.remove((()=>t()),i)}),i)}))}},[["render",function(t,i,s,n,o,a){return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("text",{class:"title"},"离线记录"),e.createElementVNode("scroll-view",{class:"record-list","scroll-y":""},[0===o.records.length?(e.openBlock(),e.createElementBlock("view",{key:0,class:"empty"},"暂无记录")):e.createCommentVNode("",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.records,((t,i)=>(e.openBlock(),e.createElementBlock("view",{key:i,class:"task-block"},[e.createElementVNode("view",{class:"task-header"},[e.createElementVNode("text",{class:"task-title"},"📂 "+e.toDisplayString(t.taskName),1)]),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.plots,((t,i)=>(e.openBlock(),e.createElementBlock("view",{key:i,class:"plot-block"},[e.createElementVNode("view",{class:"plot-header"},[e.createElementVNode("text",{class:"plot-title"},"🏷 "+e.toDisplayString(t.plotName),1)]),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.items,((t,i)=>(e.openBlock(),e.createElementBlock("view",{key:t.id,class:"record-item"},[e.createElementVNode("image",{src:t.image,mode:"aspectFill",class:"record-img"},null,8,["src"]),e.createElementVNode("view",{class:"record-info"},[e.createElementVNode("text",null,"病害："+e.toDisplayString(t.diseaseType),1),e.createElementVNode("text",null,"等级："+e.toDisplayString(t.diseaseLevel),1),e.createElementVNode("text",null,"经度："+e.toDisplayString(t.longitude),1),e.createElementVNode("text",null,"纬度："+e.toDisplayString(t.latitude),1),e.createElementVNode("text",null,"备注："+e.toDisplayString(t.remark),1),e.createElementVNode("text",null,"时间："+e.toDisplayString(t.timestamp),1)])])))),128))])))),128))])))),128))])])}]]);__definePage("pages/login/login",he),__definePage("pages/index/index",ue),__definePage("pages/message/message",me),__definePage("pages/task-list/task-list",pe),__definePage("pages/task-detail/task-detail",ge),__definePage("pages/collect/collect",fe),__definePage("pages/result/result",ve),__definePage("pages/offline/offline",ye),__definePage("pages/record/record",we);const ke=ce({onLaunch:function(){t("log","at App.vue:7","App Launch")},onShow:function(){t("log","at App.vue:10","App Show")},onHide:function(){t("log","at App.vue:13","App Hide")}},[["render",function(t,i,s,n,o,a){const r=e.resolveComponent("router-view");return e.openBlock(),e.createBlock(r)}]]);const{app:Ee,Vuex:be,Pinia:Ne}={app:e.createVueApp(ke)};uni.Vuex=be,uni.Pinia=Ne,Ee.provide("__globalStyles",__uniConfig.styles),Ee._component.mpType="app",Ee._component.render=()=>{},Ee.mount("#app")}(Vue);
